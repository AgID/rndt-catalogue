<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
* Esri Italy 2019
* Schematron per i dataset e raster con profilo RNDT 2.0
*/ 
-->
<sch:schema xmlns:sch="http://purl.oclc.org/dsdl/schematron"
	xmlns:gmd="http://www.isotc211.org/2005/gmd"
	xmlns:gco="http://www.isotc211.org/2005/gco" xmlns:srv="http://www.isotc211.org/2005/srv"
	xmlns:gmx="http://www.isotc211.org/2005/gmx" xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:gml="http://www.opengis.net/gml/3.2"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<sch:ns uri="http://www.isotc211.org/2005/gmd" prefix="gmd"/>
	<sch:ns uri="http://www.isotc211.org/2005/gco" prefix="gco"/>
	<sch:ns uri="http://www.isotc211.org/2005/srv" prefix="srv"/>
	<sch:ns uri="http://www.isotc211.org/2005/gmx" prefix="gmx"/>
	<sch:ns uri="http://www.w3.org/1999/xlink" prefix="xlink"/>
	<sch:ns uri="http://www.opengis.net/gml/3.2" prefix="gml"/>
	<sch:ns uri="http://www.w3.org/2001/XMLSchema-instance" prefix="xsi"/>
	<sch:let name="lowercase" value="'abcdefghijklmnopqrstuvwxyz'"/>
	<sch:let name="uppercase" value="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/>

	<!-- ############################################ -->
	<!-- General issues.                              -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing implementation</sch:title>
		<sch:rule context="/*">
			<sch:assert test="namespace-uri(/*) = 'http://www.isotc211.org/2005/gmd'">Il documento
				XML e' definito in un namespace sbagliato: <sch:value-of select="namespace-uri(/*)"
				/>
			</sch:assert>
			<sch:report role="INFO" test="namespace-uri(/*) = 'http://www.isotc211.org/2005/gmd'">Il
				namespace del documento e' <sch:value-of select="namespace-uri(/*)"/>
			</sch:report>
		</sch:rule>
	</sch:pattern>

	<!-- ############################################ -->
	<!-- Metadata on metadata                         -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Metadata on metadata' elements</sch:title>
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert test="gmd:fileIdentifier/*">La struttura dell'xml è errata: sezione
				gmd:MD_Metadata/gmd:fileIdentifier non presente </sch:assert>
			<sch:assert test="gmd:dateStamp/*">La struttura dell'xml è errata: sezione
				gmd:MD_Metadata/gmd:dateStamp non presente </sch:assert>
			<sch:assert test="gmd:metadataStandardName/*">La struttura dell'xml è errata: sezione
				gmd:MD_Metadata/gmd:metadataStandardName non presente </sch:assert>
			<sch:assert test="gmd:metadataStandardVersion/*">La struttura dell'xml è errata: sezione
				gmd:MD_Metadata/gmd:metadataStandardVersion non presente </sch:assert>
			<sch:assert test="gmd:language/*">La struttura dell'xml è errata: sezione
				gmd:MD_Metadata/gmd:language non presente </sch:assert>
			<sch:assert test="gmd:hierarchyLevel/*">La struttura dell'xml è errata: sezione
				//gmd:MD_Metadata/gmd:hierarchyLevel non presente </sch:assert>
			<sch:assert test="gmd:contact/*">La struttura dell'xml è errata: sezione
				gmd:MD_Metadata/gmd:contact non presente </sch:assert>
			<sch:assert test="gmd:referenceSystemInfo/gmd:MD_ReferenceSystem/gmd:referenceSystemIdentifier/gmd:RS_Identifier/gmd:code/*/text()">Il sistema di riferimento non è presente</sch:assert>
			<sch:assert test="gmd:distributionInfo/gmd:MD_Distribution/gmd:distributionFormat">Il formato non è presente</sch:assert>
			<sch:assert test="gmd:distributionInfo/gmd:MD_Distribution/gmd:distributor">Il distributore non è presente</sch:assert>
		</sch:rule>

		<!-- Elementi singoli. Meglio così per testarli in modo separato e non avere conflitto con la rule generale -->
		<sch:rule context="/gmd:MD_Metadata/gmd:fileIdentifier">
			<sch:let name="fileIdentifier" value="gco:CharacterString/text()"/>
			<!-- assertions and report -->
			<sch:assert test="$fileIdentifier">L'elemento "Identificatore del file" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$fileIdentifier">Identificatore del file: <sch:value-of
					select="$fileIdentifier"/>
			</sch:report>
		</sch:rule>
		<sch:rule context="/gmd:MD_Metadata/gmd:dateStamp">
			<sch:let name="dateStamp" value="gco:Date/text()"/>
			<!-- assertions and report -->
			<sch:assert test="$dateStamp">L'elemento "Data dei metadati" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$dateStamp">Data dei metadati: <sch:value-of
					select="$dateStamp"/>
			</sch:report>
		</sch:rule>

		<sch:rule context="/gmd:MD_Metadata/gmd:metadataStandardName">
			<sch:let name="metadataStandardName" value="./*/text()"/>


			<sch:let name="metadataStandardNameAnchorPresent" value="gmx:Anchor/text()"/>
			<sch:let name="metadataStandardNameLink" value="gmx:Anchor/@xlink:href"/>
			<!-- assertions and report -->
			<!--<sch:assert test="$metadataStandardName = 'DM - Regole tecniche RNDT 2.0'">L'elemento
				"Nome dello Standard" non presente o errato: deve essere "DM - Regole tecniche RNDT 2.0"</sch:assert>-->
			<sch:assert test="translate($metadataStandardName, $uppercase, $lowercase) = 'linee guida rndt'">L'elemento
				"Nome dello Standard" non presente o errato: deve essere "Linee Guida RNDT"</sch:assert>
			<sch:report role="INFO" test="$metadataStandardName">Nome dello Standard: <sch:value-of
					select="$metadataStandardName"/>
			</sch:report>
			<sch:assert
				test="($metadataStandardNameAnchorPresent and ($metadataStandardNameLink = 'https://registry.geodati.gov.it/document/rndt-lg' or $metadataStandardNameLink = 'http://registry.geodati.gov.it/document/rndt-lg')) or (not($metadataStandardNameAnchorPresent))"
				>L'elemento link al nome dello Standard è errato</sch:assert>
			<sch:report role="INFO" test="$metadataStandardNameLink = ''">Link allo Standard:
					<sch:value-of select="$metadataStandardNameLink"/>
			</sch:report>
		</sch:rule>

		<sch:rule context="/gmd:MD_Metadata/gmd:metadataStandardVersion">
			<sch:let name="metadataStandardVersion" value="gco:CharacterString/text()"/>
			<!--<sch:assert test="$metadataStandardVersion = '10 novembre 2011'">L'elemento "Versione
				dello Standard" non e' presente o ha un valore errato</sch:assert>-->
			<sch:assert test="$metadataStandardVersion = '2.0'">L'elemento "Versione
				dello Standard" non e' presente o ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$metadataStandardVersion">Versione dello Standard:
					<sch:value-of select="$metadataStandardVersion"/>
			</sch:report>
		</sch:rule>

		<sch:rule context="/gmd:MD_Metadata/gmd:language">
			<sch:let name="language"
				value="translate(gmd:LanguageCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="language_present"
				value="
					$language = 'bul' or
					$language = 'ita' or
					$language = 'cze' or
					$language = 'lav' or
					$language = 'dan' or
					$language = 'lit' or
					$language = 'dut' or
					$language = 'mlt' or
					$language = 'eng' or
					$language = 'pol' or
					$language = 'est' or
					$language = 'por' or
					$language = 'fin' or
					$language = 'rum' or
					$language = 'fre' or
					$language = 'slo' or
					$language = 'ger' or
					$language = 'slv' or
					$language = 'gre' or
					$language = 'spa' or
					$language = 'hun' or
					$language = 'swe' or
					$language = 'gle'"/>
					
			 <sch:let name="languageCode"
				value="gmd:LanguageCode/@codeList"/>

			<sch:assert test="$language_present">L'elemento "Lingua dei metadati" non e' presente o
				ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$language_present">Lingua dei metadati: <sch:value-of
					select="$language"/>
			</sch:report>
			
			<sch:assert test="$languageCode='http://www.loc.gov/standards/iso639-2/' or $languageCode='http://www.loc.gov/standards/iso639-2'">La codelist indicata per la lingua dei metadati non e' presente o
				ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$languageCode='http://www.loc.gov/standards/iso639-2/' or $languageCode='http://www.loc.gov/standards/iso639-2'">Codelist lingua metadati: <sch:value-of
					select="$languageCode"/>
			</sch:report>
		</sch:rule>

		<!-- Livello gerarchico: deve essere servizio -->
		<sch:rule context="/gmd:MD_Metadata/gmd:hierarchyLevel">
			<sch:let name="resourceType"
				value="translate(gmd:MD_ScopeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="resourceTypeName"
				value="translate(../gmd:hierarchyLevelName/gco:CharacterString/text(), $uppercase, $lowercase)"/>

			<!-- Il livello deve essere dataset -->
			<sch:assert test="$resourceType = 'dataset'">L'elemento
				"Livello gerarchico" non e' presente o non è corretto</sch:assert>
			<sch:report role="INFO" test="$resourceType">Livello gerarchico: <sch:value-of
					select="$resourceType"/>
			</sch:report>

			<!-- Per i dati il nome livello non c'è, ma se c'è deve essre uguale al livello -->
			<sch:assert test="($resourceTypeName and ($resourceTypeName = $resourceType)) or (not($resourceTypeName))">L'elemento "Nome Livello
				gerarchico" e' presente ma ha un valore diverso dal livello</sch:assert>
			<sch:report role="INFO" test="$resourceTypeName">Nome Livello gerarchico: <sch:value-of
					select="$resourceTypeName"/>
			</sch:report>
		</sch:rule>


		<sch:rule context="/gmd:MD_Metadata/gmd:contact">
			<sch:let name="organisationName"
				value="gmd:CI_ResponsibleParty/gmd:organisationName/gco:CharacterString/text()"/>
			<sch:let name="role"
				value="translate(gmd:CI_ResponsibleParty/gmd:role/gmd:CI_RoleCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="roleCode"
				value="gmd:CI_ResponsibleParty/gmd:role/gmd:CI_RoleCode/@codeListValue"/>

			<!-- Diventati opzionali 
			<sch:let name="telephone" value="gmd:contactInfo/*/gmd:phone/*/gmd:voice/*/text()"/>
			<sch:let name="onlineResource" value="gmd:contactInfo/*/gmd:onlineResource/*/gmd:linkage/*/text()"/>
			-->
			<sch:let name="emailAddress"
				value="gmd:CI_ResponsibleParty/gmd:contactInfo/*/gmd:address/*/gmd:electronicMailAddress/gco:CharacterString/text()"/>

			<!-- assertions and report -->
			<sch:assert test="$organisationName">L'elemento "Responsabile dei metadati - Nome Ente"
				non e' presente</sch:assert>
			<sch:report role="INFO" test="$organisationName">Responsabile dei metadati - Nome Ente:
					<sch:value-of select="$organisationName"/>
			</sch:report>

			<sch:assert test="$emailAddress">L'elemento "Responsabile dei metadati - E-mail" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$emailAddress">Responsabile dei metadati - E-mail:
					<sch:value-of select="$emailAddress"/>
			</sch:report>
			<sch:assert test="$role = 'pointofcontact' or $role = 'punto di contatto'">L'elemento
				"Responsabile dei metadati - Ruolo" non è presente o ha un valore sbagliato. Il
				valore del ruolo del responsabile dei metadati deve essere 'Punto di contatto'
				('pointOfContact')</sch:assert>
			<sch:report role="INFO" test="$role">Responsabile dei metadati - Ruolo: <sch:value-of
					select="$role"/>
			</sch:report>
			<sch:assert test="$roleCode = 'pointOfContact'">L'elemento "Responsabile dei metadati -
				Codice Ruolo" non è presente o ha un valore sbagliato. Il valore del codcie ruolo
				del responsabile dei metadati deve essere 'pointOfContact'</sch:assert>
			<sch:report role="INFO" test="$role">Responsabile dei metadati - Codice Ruolo:
					<sch:value-of select="$role"/>
			</sch:report>
		</sch:rule>
	</sch:pattern>

	<!-- ############################################ -->
	<!-- Identification (title, abstract, standard, etc). 
		Le keyword, il responsabile, il punto di contatto, il tipo di servizio, i constraints e l'estensione sono separati-->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Identification' elements</sch:title>
		<!-- In questa prima parte si testano tutti gli xPath delle altre regole, per essere sicuri che ci entri -->
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert test="gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation">La struttura
				dell'xml è errata: sezione //gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation
				non presente </sch:assert>
			<!-- Il Formato di presentazione è ora opzionale 
			<sch:assert test="gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation/gmd:presentationForm">La struttura
				dell'xml è errata: sezione //gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation/gmd:presentationForm
				non presente </sch:assert> -->
			<sch:assert test="gmd:identificationInfo/*/gmd:abstract">La struttura dell'xml è errata:
				sezione gmd:identificationInfo/*/gmd:abstract non presente </sch:assert>
		</sch:rule>

		<!-- Titolo, identificativo e data -->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation">
			<sch:let name="resourceTitle" value="gmd:title/gco:CharacterString/text()"/>
			<sch:let name="resourceIdentifier_code" value="gmd:identifier/*/gmd:code/*/text()"/>
			<sch:let name="resourceIdentifier_codeSpace"
				value="gmd:identifier/*/gmd:codeSpace/*/text()"/>
			<sch:let name="date" value="gmd:date/gmd:CI_Date/gmd:date/gco:Date/text()"/>
			<sch:let name="IdLivelloSuperiore" value="gmd:series/gmd:CI_Series/gmd:issueIdentification/gco:CharacterString/text()"/>

			<!-- assertions and report -->
			<sch:assert test="$resourceTitle">L'elemento "Titolo" non e' presente</sch:assert>
			<sch:report role="INFO" test="$resourceTitle">Titolo: <sch:value-of
					select="$resourceTitle"/>
			</sch:report>
			<sch:assert test="$resourceIdentifier_code">L'elemento "Identificatore dei dati" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$resourceIdentifier_code">Identificatore: <sch:value-of
					select="$resourceIdentifier_code"/>
			</sch:report>
			<sch:assert test="$date">L'elemento "data dei dati" non e' presente</sch:assert>
			<sch:report role="INFO" test="$date">Data dei dati: <sch:value-of select="$date"/>
			</sch:report>
			<sch:assert test="$IdLivelloSuperiore">L'elemento "Id livello superiore" non e' presente</sch:assert>
			<sch:report role="INFO" test="$IdLivelloSuperiore">Id livello superiore:
				<sch:value-of select="$IdLivelloSuperiore"/>
			</sch:report>

			<!-- Almeno una data con creation o revision o publication e non più di una data dello stesso tipo -->
			<sch:assert
				test="count(gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode[@codeListValue = 'creation' or @codeListValue = 'publication' or @codeListValue = 'revision']) > 0"
				>L'elemento "tipo di data" non e' presente o ha un valore errato</sch:assert>
			<sch:assert
				test="count(gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode[@codeListValue = 'creation']) &lt; 2"
				>Esistono più date  di tipo "creation". Deve essere presente solo una</sch:assert>
			<sch:assert
				test="count(gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode[@codeListValue = 'revision']) &lt; 2"
				>Esistono più date  di tipo "revision". Deve essere presente solo una</sch:assert>
			<sch:assert
				test="count(gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode[@codeListValue = 'publication']) &lt; 2"
				>Esistono più date  di tipo "publication". Deve essere presente solo una</sch:assert>

		</sch:rule>
		
		<sch:rule
			context="/gmd:MD_Metadata/gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode">
		
			<sch:assert
				test="@codeListValue = 'creation' or @codeListValue = 'publication' or @codeListValue = 'revision'"
				>L'elemento "tipo di data" ha un valore errato</sch:assert>
		
		</sch:rule>
		
		<!-- Formato di presentazione -->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation/gmd:presentationForm">
			
			<sch:let name="presentationForm" value="translate(gmd:CI_PresentationFormCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="presentationFormCode" value="gmd:CI_PresentationFormCode/@codeListValue"/>
			<sch:let name="presentationFormOK" value="$presentationForm='documento digitale'
																or $presentationForm='documento cartaceo'
																or $presentationForm='immagine digitale'
																or $presentationForm='immagine cartacea'
																or $presentationForm='mappa digitale'
																or $presentationForm='mappa cartacea'
																or $presentationForm='modello digitale'
																or $presentationForm='modello fisico'
																or $presentationForm='profilo digitale'
																or $presentationForm='profilo cartaceo'
																or $presentationForm='tabella digitale'
																or $presentationForm='tabella cartacea'
																or $presentationForm='video digitale'
																or $presentationForm='video analogico'"/>			
			<sch:let name="presentationFormCodeOK" value="$presentationFormCode='documentDigital'
																or $presentationFormCode='documentHardcopy'
																or $presentationFormCode='imageDigital'
																or $presentationFormCode='imageHardcopy'
																or $presentationFormCode='mapDigital'
																or $presentationFormCode='mapHardcopy'
																or $presentationFormCode='modelDigital'
																or $presentationFormCode='modelHardcopy'
																or $presentationFormCode='profileDigital'
																or $presentationFormCode='profileHardcopy'
																or $presentationFormCode='tableDigital'
																or $presentationFormCode='tableHardcopy'
																or $presentationFormCode='videoDigital'
																or $presentationFormCode='videoHardcopy'"/>	
			<sch:assert test="$presentationFormOK or $presentationFormCodeOK">L'elemento formato di presentazione non e' presente o non ha un valore valido</sch:assert>
			<sch:report role="INFO" test="$presentationFormOK">Formato di presentazione: <sch:value-of select="$presentationForm"/>
			</sch:report>
			<sch:report role="INFO" test="$presentationFormCodeOK">Codice Formato di presentazione: <sch:value-of select="$presentationFormCode"/>
			</sch:report>			

		</sch:rule>	

		<!-- Descrizione -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/*/gmd:abstract">
			<sch:let name="resourceAbstract" value="*/text()"/>

			<!-- assertions and report -->
			<sch:assert test="$resourceAbstract">L'elemento "Descrizione" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$resourceAbstract">Descrizione: <sch:value-of
					select="$resourceAbstract"/>
			</sch:report>
		</sch:rule>

	</sch:pattern>


	<!-- ############################################ -->
	<!-- Identification: Keyword                                      -->
	<!-- ############################################ -->
	<sch:pattern >
		<sch:title>Testing 'Keyword' elements</sch:title>
		
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert test="gmd:identificationInfo/gmd:MD_DataIdentification/gmd:descriptiveKeywords//gmd:MD_Keywords/gmd:thesaurusName/gmd:CI_Citation/gmd:title[gmx:Anchor/@xlink:href = 'http://www.eionet.europa.eu/gemet/it/inspire-themes' or gmx:Anchor/@xlink:href = 'http://www.eionet.europa.eu/gemet/inspire_themes' or gmx:Anchor/@xlink:href = 'https://www.eionet.europa.eu/gemet/it/inspire-themes' or gmx:Anchor/@xlink:href = 'https://www.eionet.europa.eu/gemet/inspire_themes' or gmx:Anchor/@xlink:href = 'http://inspire.ec.europa.eu/theme' or gmx:Anchor/@xlink:href = 'https://inspire.ec.europa.eu/theme' or gco:CharacterString/text() = 'GEMET - INSPIRE themes, version 1.0']/*">La struttura dell'xml è errata: sezione del Thesaurus INSPIRE
				 non presente </sch:assert>
		</sch:rule>
		
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:descriptiveKeywords/gmd:MD_Keywords/gmd:thesaurusName/gmd:CI_Citation/gmd:title[gmx:Anchor/@xlink:href != 'https://www.eionet.europa.eu/gemet/it/inspire-themes' or gmx:Anchor/@xlink:href != 'https://www.eionet.europa.eu/gemet/inspire_themes' or gco:CharacterString/text() != 'GEMET - INSPIRE themes, version 1.0' or gmx:Anchor/@xlink:href != 'https://www.eionet.europa.eu.gemet' or gmx:Anchor/@xlink:href != 'http://inspire.ec.europa.eu/theme' or gmx:Anchor/@xlink:href != 'https://inspire.ec.europa.eu/theme' or gco:CharacterString/text() != 'GEMET – Concepts, version 2.4' or gmx:Anchor/@xlink:href != 'http://inspire.ec.europa.eu/metadata-codelist/SpatialScope' or gco:CharacterString/text() != 'Spatial scope' or gco:CharacterString/text() != 'spatial scope' or gmx:Anchor/@xlink:href != 'http://inspire.ec.europa.eu/metadata-codelist/PriorityDataset' or translate(gco:CharacterString/text(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz')  != 'inspire priority data set']">
			
			<sch:let name="thesaurus_dateType" value="translate(../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="thesaurus_dateTypeCode" value="../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			
			<sch:assert test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Il tipo data del thesaurus è sbagliato.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Tipo data del thesaurus:
				<sch:value-of select="$thesaurus_dateType"/>
			</sch:report>
		</sch:rule>
		
		<!-- Ci sono 4 sezioni per le keyword dei dataset: 1 con il Thesaurus INSPIRE, 1 con il Thesaurus GEMET, 1 con un altro Thesaurus e 1 con parole libere. 
			Faccio una rule solo per INSPIRE e GEMET, per il resto l'utente può fare quello che vuole  -->
		
		<!-- Thesaurus INSPIRE. Testo i valori sia in inglese che in italiano, sia Character che Anchor(solo il link) -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:descriptiveKeywords/gmd:MD_Keywords/gmd:thesaurusName/gmd:CI_Citation/gmd:title[gmx:Anchor/@xlink:href = 'https://www.eionet.europa.eu/gemet/it/inspire-themes' or gmx:Anchor/@xlink:href = 'https://www.eionet.europa.eu/gemet/inspire_themes' or gmx:Anchor/@xlink:href = 'http://inspire.ec.europa.eu/theme' or gmx:Anchor/@xlink:href = 'https://inspire.ec.europa.eu/theme' or gco:CharacterString/text() = 'GEMET - INSPIRE themes, version 1.0']">
			<sch:let name="keywordValueChar" value="../../../gmd:keyword/gco:CharacterString/text()"/>
			<sch:let name="keywordValueChar_OK" value="$keywordValueChar='Addresses' or
				$keywordValueChar='Administrative units' or
				$keywordValueChar='Agricultural and aquaculture facilities' or
				$keywordValueChar='Area management/restriction/regulation zones and reporting units' or
				$keywordValueChar='Atmospheric conditions' or
				$keywordValueChar='Bio-geographical regions' or
				$keywordValueChar='Buildings' or
				$keywordValueChar='Cadastral parcels' or
				$keywordValueChar='Coordinate reference systems' or
				$keywordValueChar='Elevation' or
				$keywordValueChar='Energy resources' or
				$keywordValueChar='Environmental monitoring facilities' or
				$keywordValueChar='Geographical grid systems' or
				$keywordValueChar='Geographical names' or
				$keywordValueChar='Geology' or
				$keywordValueChar='Habitats and biotopes' or
				$keywordValueChar='Human health and safety' or
				$keywordValueChar='Hydrography' or
				$keywordValueChar='Land cover' or
				$keywordValueChar='Land use' or
				$keywordValueChar='Meteorological geographical features' or
				$keywordValueChar='Mineral resources' or
				$keywordValueChar='Natural risk zones' or
				$keywordValueChar='Oceanographic geographical features' or
				$keywordValueChar='Orthoimagery' or
				$keywordValueChar='Population distribution — demography' or
				$keywordValueChar='Population distribution - demography' or
				$keywordValueChar='Production and industrial facilities' or
				$keywordValueChar='Protected sites' or
				$keywordValueChar='Sea regions' or
				$keywordValueChar='Soil' or
				$keywordValueChar='Species distribution' or
				$keywordValueChar='Statistical units' or
				$keywordValueChar='Transport networks' or
				$keywordValueChar='Utility and governmental services' or
				$keywordValueChar='Condizioni atmosferiche' or
				$keywordValueChar='Produzione e impianti industriali' or
				$keywordValueChar='Copertura del suolo' or
				$keywordValueChar='Regioni biogeografiche' or
				$keywordValueChar='Distribuzione della popolazione — demografia' or
				$keywordValueChar='Distribuzione della popolazione — demografia' or
				$keywordValueChar='Regioni marine' or
				$keywordValueChar='Distribuzione delle specie' or
				$keywordValueChar='Reti di trasporto' or
				$keywordValueChar='Edifici' or
				$keywordValueChar='Risorse energetiche' or
				$keywordValueChar='Elementi geografici meteorologici' or
				$keywordValueChar='Risorse minerarie' or
				$keywordValueChar='Elementi geografici oceanografici' or
				$keywordValueChar='Salute umana e sicurezza' or
				$keywordValueChar='Elevazione' or
				$keywordValueChar='Servizi di pubblica utilità e servizi amministrativi' or
				$keywordValueChar='Geologia' or
				$keywordValueChar='Sistemi di coordinate' or
				$keywordValueChar='Habitat e biotopi' or
				$keywordValueChar='Sistemi di griglie geografiche' or
				$keywordValueChar='Idrografia' or
				$keywordValueChar='Siti protetti' or
				$keywordValueChar='Impianti agricoli e di acquacoltura' or
				$keywordValueChar='Suolo' or
				$keywordValueChar='Impianti di monitoraggio ambientale' or
				$keywordValueChar='Unità amministrative' or
				$keywordValueChar='Indirizzi' or
				$keywordValueChar='Unità statistiche' or
				$keywordValueChar='Nomi geografici' or
				$keywordValueChar='Utilizzo del territorio' or
				$keywordValueChar='Orto immagini' or
				$keywordValueChar='Zone a rischio naturale' or
				$keywordValueChar='Parcelle catastali' or
				$keywordValueChar='Zone sottoposte a gestione/limitazioni/regolamentazione e unità con obbligo di comunicare dati'"/>
			<sch:let name="keywordValueLink" value="../../../gmd:keyword/gmx:Anchor/@xlink:href"/>
			<sch:let name="keywordValueLink_OK" value="$keywordValueLink='http://inspire.ec.europa.eu/theme/ad' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/au' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/rs' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/gg' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/cp' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/gn' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/hy' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/ps' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/tn' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/el' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/ge' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/lc' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/oi' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/af' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/am' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/ac' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/br' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/bu' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/er' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/ef' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/hb' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/hh' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/lu' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/mr' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/nz' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/of' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/pd' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/pf' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/sr' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/so' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/sd' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/su' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/us' or
				$keywordValueLink='http://inspire.ec.europa.eu/theme/mf'"/>
			<!-- Asserts e reports sulle parole chiave -->
			<sch:assert test="$keywordValueChar_OK or $keywordValueLink_OK">Per le serie e i dataset deve essere documentata almeno una parola chiave tratta dal thesaurus GEMET e corrispondente al tema INSPIRE di riferimento di cui agli allegati della Direttiva.</sch:assert>
			<sch:report role="INFO"  test="$keywordValueChar_OK">Parola chiave Char:
				<sch:value-of select="$keywordValueChar"/>
			</sch:report>
			<sch:report role="INFO" test="$keywordValueLink_OK">Parola chiave Link:
				<sch:value-of select="$keywordValueLink"/>
			</sch:report>
			
			<!-- Testo gli elementi del thesaurus. Il titolo fa parte del context, quindi non lo testo  -->
			<sch:let name="thesaurus_date" value="../gmd:date/gmd:CI_Date/gmd:date/gco:Date/text()"/>
			<sch:let name="thesaurus_dateType" value="translate(../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="thesaurus_dateTypeCode" value="../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			
			<!--<sch:assert test="$thesaurus_date = '2010-01-19'">La data del thesaurus INSPIRE è errata: deve essere '2010-01-19'.</sch:assert>-->
			<sch:assert test="$thesaurus_date='2008-06-01'">La data del thesaurus INSPIRE non è presente o è sbagliata.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_date">Data del Thesaurus INSPIRE:
				<sch:value-of select="$thesaurus_date"/>
			</sch:report>
			<!--<sch:assert test="$thesaurus_dateType = 'pubblicazione' or $thesaurus_dateType = 'publication' or $thesaurus_dateTypeCode = 'publication'">Il tipo data del thesaurus INSPIRE deve essere 'Pubblicazione' o 'publication'.</sch:assert>-->
			<sch:assert test="$thesaurus_dateType">Il tipo data del thesaurus INSPIRE non è presente.</sch:assert>
			<sch:assert test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Il tipo data del thesaurus INSPIRE è sbagliato.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_dateType">Tipo data del Thesaurus INSPIRE:
				<sch:value-of select="$thesaurus_dateType"/>
			</sch:report>			
		</sch:rule>

		<!-- Thesaurus GEMET.  -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:descriptiveKeywords/gmd:MD_Keywords/gmd:thesaurusName/gmd:CI_Citation/gmd:title[gmx:Anchor/@xlink:href = 'https://www.eionet.europa.eu.gemet' or gco:CharacterString/text() = 'GEMET – Concepts, version 2.4']">
			<!-- Testo gli elementi del thesaurus. Il titolo fa parte del context, quindi nno lo testo  -->
			<sch:let name="thesaurus_date" value="../gmd:date/gmd:CI_Date/gmd:date/gco:Date"/>
			<sch:let name="thesaurus_dateType" value="translate(../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="thesaurus_dateTypeCode" value="../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			<!--<sch:assert test="$thesaurus_date = '2019-01-28'">La data del thesaurus GEMET è errata: deve essere '2019-01-28'.</sch:assert>-->
			<sch:assert test="$thesaurus_date">La data del thesaurus GEMET non è presente.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_date">Data del Thesaurus GEMET:
				<sch:value-of select="$thesaurus_date"/>
			</sch:report>
			<!--<sch:assert test="$thesaurus_dateType = 'pubblicazione' or $thesaurus_dateType = 'publication' or $thesaurus_dateTypeCode = 'publication'">Il tipo data del thesaurus GEMET deve essere 'Pubblicazione' o 'publication'.</sch:assert>-->
			<sch:assert test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Il tipo data del thesaurus GEMET non è presente o è errato.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Tipo data del Thesaurus GEMET:
				<sch:value-of select="$thesaurus_dateType"/>
			</sch:report>			
		</sch:rule>	

		<!-- Parole chiave per ambito di applicazione territoriale, con thesaurus 'Spatial scope' -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:descriptiveKeywords/gmd:MD_Keywords/gmd:thesaurusName/gmd:CI_Citation/gmd:title[gmx:Anchor/@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialScope' or gco:CharacterString/text() = 'Spatial scope' or gco:CharacterString/text() = 'spatial scope']">
			<sch:let name="keywordValueChar" value="../../../gmd:keyword/gco:CharacterString/text()"/>
			<sch:let name="keywordValueChar_OK" value="$keywordValueChar='Europeo' or
														$keywordValueChar='European' or
														$keywordValueChar='Globale' or
														$keywordValueChar='Global' or
														$keywordValueChar='Locale' or
														$keywordValueChar='Local' or
														$keywordValueChar='Nazionale' or
														$keywordValueChar='National' or
														$keywordValueChar='Regionale' or
														$keywordValueChar='Regional'"/>
			
			<sch:let name="keywordValueLink" value="../../../gmd:keyword/gmx:Anchor/@xlink:href"/>
			<sch:let name="keywordValueLink_OK" value="$keywordValueLink='http://inspire.ec.europa.eu/metadata-codelist/SpatialScope/european' or
				$keywordValueLink='http://inspire.ec.europa.eu/metadata-codelist/SpatialScope/global' or
				$keywordValueLink='http://inspire.ec.europa.eu/metadata-codelist/SpatialScope/local' or
				$keywordValueLink='http://inspire.ec.europa.eu/metadata-codelist/SpatialScope/national' or
				$keywordValueLink='http://inspire.ec.europa.eu/metadata-codelist/SpatialScope/regional'"/>
			<!-- Asserts e reports sulle parole chiave -->
			<sch:assert test="$keywordValueChar_OK or $keywordValueLink_OK">La parola chiave relativa all'ambito di applicazione territoriale è assente o è errata.</sch:assert>
			<sch:report role="INFO"  test="$keywordValueChar_OK">Parola chiave Char:
				<sch:value-of select="$keywordValueChar"/>
			</sch:report>
			<sch:report role="INFO" test="$keywordValueLink_OK">Parola chiave Link:
				<sch:value-of select="$keywordValueLink"/>
			</sch:report>
			
			<!-- Testo gli elementi del thesaurus. Il titolo fa parte del context, quindi nno lo testo  -->
			<sch:let name="thesaurus_date" value="../gmd:date/gmd:CI_Date/gmd:date/gco:Date"/>
			<sch:let name="thesaurus_dateType" value="translate(../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="thesaurus_dateTypeCode" value="../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			
			<sch:assert test="$thesaurus_date">La data del thesaurus relativo all'ambito di applicazione territoriale non è presente.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_date">Data del Thesaurus relativo all'ambito di applicazione territoriale:
				<sch:value-of select="$thesaurus_date"/>
			</sch:report>

			<sch:assert test="$thesaurus_dateType">Il tipo data del thesaurus relativo all'ambito di applicazione territoriale non è presente.</sch:assert>
			<sch:assert test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Il tipo data del thesaurus relativo all'ambito di applicazione territoriale è sbagliato.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_dateType">Tipo data del Thesaurus relativo all'ambito di applicazione territoriale:
				<sch:value-of select="$thesaurus_dateType"/>
			</sch:report>			
		</sch:rule>
		
		<!-- Thesaurus 'INSPIRE priority data set' -->												
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:descriptiveKeywords/gmd:MD_Keywords/gmd:thesaurusName/gmd:CI_Citation/gmd:title[gmx:Anchor/@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/PriorityDataset' or translate(gco:CharacterString/text(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz')  = 'inspire priority data set']">
			
			<sch:let name="thesaurus_date" value="../gmd:date/gmd:CI_Date/gmd:date/gco:Date"/>
			<sch:let name="thesaurus_dateType" value="translate(../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="thesaurus_dateTypeCode" value="../gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			
			<sch:assert test="$thesaurus_date='2018-04-04'">La data del thesaurus relativo ai dataset prioritari non è presente o è sbagliata.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_date">Data del Thesaurus relativo ai dataset prioritari:
				<sch:value-of select="$thesaurus_date"/>
			</sch:report>

			<sch:assert test="$thesaurus_dateType">Il tipo data del thesaurus relativo ai dataset prioritari non è presente.</sch:assert>
			<sch:assert test="$thesaurus_dateTypeCode='publication' and ($thesaurus_dateType='pubblicazione' or $thesaurus_dateType='publication')">Il tipo data del thesaurus relativo ai dataset prioritari è sbagliato.</sch:assert>
			<sch:report role="INFO" test="$thesaurus_dateType">Tipo data del Thesaurus relativo ai dataset prioritari:
				<sch:value-of select="$thesaurus_dateType"/>
			</sch:report>			
		</sch:rule>

	</sch:pattern>

	<!-- ############################################ -->
	<!-- Identification: Responsible organisation                  -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Responsible organisation' elements</sch:title>

		<!-- In questa prima parte si testano tutti gli xPath delle altre regole, per essere sicuri che ci entri -->
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert
				test="gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation/gmd:citedResponsibleParty"
				>La struttura dell'xml è errata: sezione
				//gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation non presente </sch:assert>
		</sch:rule>


		<sch:rule
			context="//gmd:identificationInfo/*/gmd:citation/gmd:CI_Citation/gmd:citedResponsibleParty">
			<sch:let name="organisationName"
				value="gmd:CI_ResponsibleParty/gmd:organisationName/gco:CharacterString/text()"/>
			<sch:let name="role"
				value="translate(gmd:CI_ResponsibleParty/gmd:role/gmd:CI_RoleCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="role_codeList"
				value="gmd:CI_ResponsibleParty/gmd:role/gmd:CI_RoleCode/@codeListValue"/>
			<sch:let name="emailAddress"
				value="gmd:CI_ResponsibleParty/gmd:contactInfo/gmd:CI_Contact/gmd:address/gmd:CI_Address/gmd:electronicMailAddress/gco:CharacterString/text()"/>

			<!-- assert and reports -->
			<sch:assert test="$organisationName">L'elemento "Responsabile - Nome Ente" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$organisationName">Responsabile - Nome Ente: <sch:value-of
					select="$organisationName"/>
			</sch:report>

			<!-- Il responsabile non deve essere pointOfContact o distributor, né come testo né come codice -->
			<!-- testo -->
			<sch:assert
				test="
				$role = 'fornitore della risorsa' or $role = 'resourceprovider' or
				$role = 'custode' or $role = 'custodian' or
				$role = 'proprietario' or $role = 'owner' or
				$role = 'utente' or $role = 'user' or
				$role = 'editore' or $role = 'publisher' or
				$role = 'autore' or $role = 'author' or
				$role = 'responsabile del trattamento' or $role = 'processor' or
				$role = 'responsabile principale delle ricerche' or $role = 'principalinvestigator' or
				$role = 'ideatore' or $role = 'originator' or
				$role = 'distributore' or $role = 'distributor' or
				$role = 'punto di contatto' or $role = 'pointofcontact'"
				>Responsabile dati: Il valore del ruolo del responsabile della risorsa è assente o errato</sch:assert>
			
			<sch:report role="INFO" test="$role">Responsabile dati: valore Ruolo: <sch:value-of select="$role"/>
			</sch:report>
			<!-- codelist -->
			<sch:assert
				test="
				$role_codeList = 'resourceProvider' or
				$role_codeList = 'custodian' or
				$role_codeList = 'owner' or
				$role_codeList = 'user' or
				$role_codeList = 'originator' or
				$role_codeList = 'principalInvestigator' or
				$role_codeList = 'processor' or
				$role_codeList = 'publisher' or
				$role_codeList = 'author' or
				$role_codeList = 'publisher' or
				$role_codeList = 'distributor' or
				$role_codeList = 'pointOfContact'"
				>Responsabile dati: il Codice del ruolo del responsabile della risorsa è assente o errato</sch:assert>
			<sch:report role="INFO" test="$role_codeList">Responsabile dati: valore Codice Ruolo: <sch:value-of
					select="$role_codeList"/>
			</sch:report>

			<sch:assert test="$emailAddress">L'elemento "Responsabile - E-mail" non e' presente </sch:assert>
			<sch:report role="INFO" test="$emailAddress">Responsabile - E-mail: <sch:value-of
					select="$emailAddress"/>
			</sch:report>

		</sch:rule>
	</sch:pattern>

	<!-- ############################################ -->
	<!-- Identification: Point of Contact
		Mantengo il più possibile la stessa struttura dei servizi -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Point of Contact' elements</sch:title>

		<!-- In questa prima parte si testano tutti gli xPath delle altre regole, per essere sicuri che ci entri -->
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert test="gmd:identificationInfo/*/gmd:pointOfContact/gmd:CI_ResponsibleParty"
				>La struttura dell'xml è errata: sezione
				gmd:identificationInfo/*/gmd:pointOfContact/gmd:CI_ResponsibleParty non presente
			</sch:assert>
		</sch:rule>

		<!-- Solo se il servizio è armonizzato o interoperabile il ruolo deve essere pointOfContact -->
		<sch:rule context="//gmd:identificationInfo/*/gmd:pointOfContact/gmd:CI_ResponsibleParty">
			<sch:let name="organisationName" value="gmd:organisationName/gco:CharacterString/text()"/>
			<sch:let name="role"
				value="translate(gmd:role/gmd:CI_RoleCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="role_codeList" value="gmd:role/gmd:CI_RoleCode/@codeListValue"/>
			<sch:let name="emailAddress"
				value="gmd:contactInfo/gmd:CI_Contact/gmd:address/gmd:CI_Address/gmd:electronicMailAddress/gco:CharacterString/text()"/>

			<!-- assert and reports -->
			<sch:assert test="$organisationName">L'elemento "Punto di contatto - Nome Ente" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$organisationName">Punto di contatto - Nome Ente:
					<sch:value-of select="$organisationName"/>
			</sch:report>

			
			<sch:assert
				test="
				$role = 'fornitore della risorsa' or $role = 'resourceprovider' or
				$role = 'custode' or $role = 'custodian' or
				$role = 'proprietario' or $role = 'owner' or
				$role = 'utente' or $role = 'user' or
				$role = 'editore' or $role = 'publisher' or
				$role = 'autore' or $role = 'author' or
				$role = 'responsabile del trattamento' or $role = 'processor' or
				$role = 'responsabile principale delle ricerche' or $role = 'principalinvestigator' or
				$role = 'ideatore' or $role = 'originator' or
				$role = 'distributore' or $role = 'distributor' or
				$role = 'punto di contatto' or $role = 'pointofcontact'"
				>Punto di contatto: Il valore del ruolo del responsabile della risorsa è assente o errato</sch:assert>
			
			<sch:report role="INFO" test="$role">Punto di contatto: valore Ruolo: <sch:value-of select="$role"/>
			</sch:report>
			
			<sch:assert
				test="
				$role_codeList = 'resourceProvider' or
				$role_codeList = 'custodian' or
				$role_codeList = 'owner' or
				$role_codeList = 'user' or
				$role_codeList = 'originator' or
				$role_codeList = 'principalInvestigator' or
				$role_codeList = 'processor' or
				$role_codeList = 'publisher' or
				$role_codeList = 'author' or
				$role_codeList = 'publisher' or
				$role_codeList = 'distributor' or
				$role_codeList = 'pointOfContact'"
				>Punto di contatto: il Codice del ruolo del responsabile della risorsa è assente o errato</sch:assert>
			<sch:report role="INFO" test="$role_codeList">Punto di contatto: valore Codice Ruolo: <sch:value-of
				select="$role_codeList"/>
			</sch:report>

			<sch:assert test="$emailAddress">L'elemento "Punto di contatto - E-mail" non e' presente </sch:assert>
			<sch:report role="INFO" test="$emailAddress">Punto di contatto - E-mail: <sch:value-of
					select="$emailAddress"/>
			</sch:report>

		</sch:rule>
	</sch:pattern>

	<!-- ############################################ -->
	<!-- Identification: Spatial representation type, language, Spatial resolution. -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Spatial representation type, Language and Spatial resolution' elements</sch:title>

		<!-- In questa prima parte si testano tutti gli xPath delle altre regole, per essere sicuri che ci entri -->
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert test="gmd:identificationInfo/gmd:MD_DataIdentification/gmd:language">
				La struttura dell'xml è errata: sezione //gmd:identificationInfo/gmd:MD_DataIdentification/gmd:language non presente
			</sch:assert>		
			<sch:assert test="gmd:identificationInfo/gmd:MD_DataIdentification/gmd:spatialRepresentationType">
				La struttura dell'xml è errata: sezione //gmd:identificationInfo/gmd:MD_DataIdentification/gmd:spatialRepresentationType non presente
			</sch:assert>
			<sch:assert test="gmd:identificationInfo/gmd:MD_DataIdentification/gmd:spatialResolution">
				La struttura dell'xml è errata: sezione //gmd:identificationInfo/gmd:MD_DataIdentification/gmd:spatialResolution non presente
			</sch:assert>
			<sch:assert test="gmd:identificationInfo/gmd:MD_DataIdentification/gmd:topicCategory">
				La struttura dell'xml è errata: sezione //gmd:identificationInfo/gmd:MD_DataIdentification/gmd:topicCategory non presente
			</sch:assert>
		</sch:rule>
		
		<!-- Tipo di rappresetazione spaziale -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:spatialRepresentationType">		
			<sch:let name="spatialRepresentationType" value="translate(gmd:MD_SpatialRepresentationTypeCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="spatialRepresentationTypeOK" value="$spatialRepresentationType='dati vettoriali' or
															$spatialRepresentationType='dati raster' or
															$spatialRepresentationType='tabella di dati alfanumerici' or
															$spatialRepresentationType='tin'"/>
	
			
			<sch:let name="spatialRepresentationTypeCode" value="gmd:MD_SpatialRepresentationTypeCode/@codeListValue"/>
			<sch:let name="spatialRepresentationTypeCodeOK" value="$spatialRepresentationTypeCode='vector' or
				$spatialRepresentationTypeCode='grid' or
				$spatialRepresentationTypeCode='textTable' or
				$spatialRepresentationTypeCode='tin'"/>
			
			<sch:assert test="$spatialRepresentationTypeCodeOK or $spatialRepresentationTypeCodeOK">Il codice del tipo di rappresentazione spaziale e' assente o errato.</sch:assert>
			<sch:report role="INFO" test="$spatialRepresentationTypeOK">Codice del tipo di rappresentazione spaziale:
				<sch:value-of select="$spatialRepresentationTypeCode"/>
			</sch:report>	
			<sch:report role="INFO" test="$spatialRepresentationTypeCodeOK">Codice del tipo di rappresentazione spaziale:
				<sch:value-of select="$spatialRepresentationTypeCode"/>
			</sch:report>	
		</sch:rule>		
		
		<!-- Risoluzione spaziale -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:spatialResolution">
			<sch:let name="spatialDistanza" value="gmd:MD_Resolution/gmd:distance/gco:Distance/text()"/>
			<sch:let name="spatialScala" value="gmd:MD_Resolution/gmd:equivalentScale/gmd:MD_RepresentativeFraction/gmd:denominator/gco:Integer/text()"/>

			<sch:assert test="($spatialDistanza or $spatialScala) and not($spatialDistanza and $spatialScala)">La risoluzione spaziale è assente o errata: va indicata o la scala equivalente o la distanza.</sch:assert>
			<sch:report role="INFO" test="$spatialDistanza">Tipo di rappresentazione spaziale Distanza:
				<sch:value-of select="$spatialDistanza"/>
			</sch:report>
			<sch:report role="INFO" test="$spatialScala">Tipo di rappresentazione spaziale Scala:
				<sch:value-of select="$spatialScala"/>
			</sch:report>
		</sch:rule>		
		
		<!-- Lingua dei dati -->			
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:language">
			<sch:let name="language"
				value="translate(gmd:LanguageCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="language_present"
				value="
				$language = 'bul' or
				$language = 'ita' or
				$language = 'cze' or
				$language = 'lav' or
				$language = 'dan' or
				$language = 'lit' or
				$language = 'dut' or
				$language = 'mlt' or
				$language = 'eng' or
				$language = 'pol' or
				$language = 'est' or
				$language = 'por' or
				$language = 'fin' or
				$language = 'rum' or
				$language = 'fre' or
				$language = 'slo' or
				$language = 'ger' or
				$language = 'slv' or
				$language = 'gre' or
				$language = 'spa' or
				$language = 'hun' or
				$language = 'swe' or
				$language = 'gle'"/>
				
				<sch:let name="languageCode"
				value="gmd:LanguageCode/@codeList"/>
			
			<sch:assert test="$language_present">L'elemento "Lingua dei dati" non e' presente o
				ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$language_present">Lingua dei dati: <sch:value-of
				select="$language"/>
			</sch:report>
			
			<sch:assert test="$languageCode='http://www.loc.gov/standards/iso639-2/' or $languageCode='http://www.loc.gov/standards/iso639-2'">La codelist indicata per la lingua dei dati non e' presente o
				ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$languageCode='http://www.loc.gov/standards/iso639-2/' or $languageCode='http://www.loc.gov/standards/iso639-2'">Codelist lingua dati: <sch:value-of
					select="$languageCode"/>
			</sch:report>
		</sch:rule>
	
		<!-- Categoria tematica (Topic category) -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:topicCategory">
			<sch:let name="topicCategory" value="gmd:MD_TopicCategoryCode/text()"/>
			<sch:let name="topicCategoryOK" value="$topicCategory = 'farming' or 
				$topicCategory = 'biota' or
				$topicCategory = 'boundaries' or
				$topicCategory = 'climatologyMeteorologyAtmosphere' or
				$topicCategory = 'economy' or
				$topicCategory = 'elevation' or
				$topicCategory = 'environment' or
				$topicCategory = 'geoscientificInformation' or
				$topicCategory = 'health' or
				$topicCategory = 'imageryBaseMapsEarthCover' or
				$topicCategory = 'intelligenceMilitary' or
				$topicCategory = 'inlandWaters' or
				$topicCategory = 'location' or
				$topicCategory = 'oceans' or
				$topicCategory = 'planningCadastre' or
				$topicCategory = 'society' or
				$topicCategory = 'structure' or
				$topicCategory = 'transportation' or
				$topicCategory = 'utilitiesCommunication'"/>
			<sch:assert test="$topicCategoryOK">L'elemento "Categoria tematica" non e' presente o ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$topicCategoryOK">Categoria tematica: <sch:value-of
				select="$topicCategory"/>
			</sch:report>
		</sch:rule>

	</sch:pattern>

	<!-- ############################################ -->
	<!-- Identification: Constraints related to access and use        -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Constraints related to access and use' elements</sch:title>

		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert
				test="gmd:identificationInfo/*/gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:accessConstraints"
				>La struttura dell'xml è errata: sezione
				//gmd:identificationInfo[1]/*/gmd:resourceConstraints/*/gmd:accessConstraints non
				presente </sch:assert>
		</sch:rule>

		<!--
			Le condizioni sono le seguenti:
			- Al più 2 istanze di accessConstraints oppure 1 di accessConstraints e 1 di useConstraints
			- Tutte queste istanze devono avere sempre valore accessConstraints/gmd:MD:RestrictionCode = 'otherRestrictions'
			- Ci deve essere 1 e 1 sola istanza di resourceContraints/accessContraints che esprime le limitazioni d'uso tramite uso di resourceContraints/otherContraints/gmx:Anchor con valori codificati (lista LimitationsOnPublicAccess)
			- Ci deve essere 1 e 1 sola istanza di resourceContraints che esprime le condizioni di accesso e uso. Questo può essere la seconda accessContraints o la useConstraints. 
			Le condizioni saranno espresse sempre tramite il tag otherContraints, o tramite gmx:Anchor codificato (lista ConditionsApplyingToAccessAndUse) o tramite gco:CharacterString e quindi testo libero.
		-->

		<!-- Test per il numero delle istanze e per i valori di access e use
		I test sono complicati, quindi mi metto ad un livello superiore per farli all'interno. -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/srv:SV_ServiceIdentification | /gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification">
			<sch:let name="accessConstraintsCount"
				value="count(gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:accessConstraints)"/>
			<sch:let name="useConstraintsCount"
				value="count(gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:useConstraints)"/>

			<!-- Le sezioni access devono essere 1 o 2 (qunidi test < 3 e > 0, quella use al massimo 1 (quindi test < 2). Se ci sono due access non ci può essere la use -->
			<sch:assert test="($accessConstraintsCount &lt; 3) and ($accessConstraintsCount &gt; 0)"
				>Ci devono essere solo 1 o due sezioni Access Constraints</sch:assert>
			<sch:assert test="$useConstraintsCount &lt; 2">Ci deve essere al più una sezione
				useConstraints</sch:assert>
			<!-- A questo punto accessContraints è 1 o 2 e useConstraints è 0 o 1. Per essere valido deve essere accessContraints = 1 e UseConstraints = 1 o accessContraints = 2 e UseConstraints= 0-->
			<sch:assert
				test="(($accessConstraintsCount = 1) and ($useConstraintsCount = 1)) or (($accessConstraintsCount = 2) and ($useConstraintsCount = 0))"
				>Se ci sono due sezioni accessConstraints non ci può essere una sezione
				useConstraints</sch:assert>

			<sch:report role="INFO" test="$accessConstraintsCount">Numero Access Constraints:
					<sch:value-of select="$accessConstraintsCount"/>
			</sch:report>

			<sch:report role="INFO" test="$useConstraintsCount">Numero Use Constraints:
					<sch:value-of select="$useConstraintsCount"/>
			</sch:report>

			<!-- Ci deve essere almeno una sezione codificata di accessContraints che esprime le limitazioni al pubblico accesso -->
			<sch:let name="limitationsOnPublicAccess"
				value="
					gmd:resourceConstraints/gmd:MD_LegalConstraints/gmd:accessConstraints/../gmd:otherConstraints/gmx:Anchor[@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/noLimitations' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1b' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1c' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1d' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1e' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1f' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1g' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/INSPIRE_Directive_Article13_1h']"/>
			<sch:assert test="$limitationsOnPublicAccess">Le limitazioni al pubblico accesso sono
				mancanti o non sono corrette (lista LimitationsOnPublicAccess)</sch:assert>
			<sch:report role="INFO" test="$limitationsOnPublicAccess">Limitazioni al pubblico
				accesso: <sch:value-of select="$limitationsOnPublicAccess"/>
			</sch:report>

			<!-- Ci deve essere almeno una sezione codificata di accessContraints o useConstraints che esprime le condizioni di accesso e uso. Può essere codificato o testo libero  -->
			<sch:let name="conditionsAccessUse"
				value="
					gmd:resourceConstraints/gmd:MD_LegalConstraints/*/../gmd:otherConstraints/gmx:Anchor[@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/ConditionsApplyingToAccessAndUse/conditionsUnknown' or
					@xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/ConditionsApplyingToAccessAndUse/noConditionsApply'] | gmd:resourceConstraints/gmd:MD_LegalConstraints/*/../gmd:otherConstraints//text()"/>
			<sch:assert test="$conditionsAccessUse">Le condizioni di accesso e uso sono mancanti o
				non sono corrette (lista ConditionsApplyingToAccessAndUse)</sch:assert>
			<sch:report role="INFO" test="$conditionsAccessUse">Condizioni di accesso e uso:
					<sch:value-of select="$conditionsAccessUse"/>
			</sch:report>
		</sch:rule>

		<!-- Test perche' sia  access che use deve comunque avere il valore otherRestriction. Qui evito il loop e sfrutto il context -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/*/gmd:resourceConstraints/gmd:MD_LegalConstraints">
			<sch:let name="codiceConstraints" value="./*/gmd:MD_RestrictionCode/@codeListValue"/>

			<sch:assert test="$codiceConstraints = 'otherRestrictions'">Il codice di
				accessConstraints o useConstraints deve essere 'otherRestrictions' </sch:assert>
			<sch:report role="INFO" test="$codiceConstraints">Codice Constraints: <sch:value-of
					select="$codiceConstraints"/>
			</sch:report>
		</sch:rule>

	</sch:pattern>

	<!-- ############################################ -->
	<!-- Identification: Estensione geografica (1,1) e temporale  (0,*) -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Service extent' elements</sch:title>

		<!-- In questa prima parte si testano tutti gli xPath delle altre regole, per essere sicuri che ci entri -->
		<sch:rule context="/gmd:MD_Metadata">
			<sch:assert
				test="gmd:identificationInfo/*/*/gmd:EX_Extent/gmd:geographicElement/gmd:EX_GeographicBoundingBox"
				>La struttura dell'xml è errata: sezione
				//gmd:identificationInfo/*/*/gmd:EX_Extent/gmd:geographicElement/gmd:EX_GeographicBoundingBox
				non presente </sch:assert>
		</sch:rule>

		<!-- Geographic Extent -->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:identificationInfo/*/*/gmd:EX_Extent/gmd:geographicElement/gmd:EX_GeographicBoundingBox">
			<sch:let name="west"
				value="number(gmd:westBoundLongitude/gco:Decimal)"/>
			<sch:let name="east"
				value="number(gmd:eastBoundLongitude/gco:Decimal)"/>
			<sch:let name="north"
				value="number(gmd:northBoundLatitude/gco:Decimal)"/>
			<sch:let name="south"
				value="number(gmd:southBoundLatitude/gco:Decimal)"/>
				
			<sch:let name="west-dec"
				value="substring-after(gmd:westBoundLongitude/gco:Decimal, '.')"/>
			<sch:let name="east-dec"
				value="substring-after(gmd:eastBoundLongitude/gco:Decimal, '.')"/>
			<sch:let name="north-dec"
				value="substring-after(gmd:northBoundLatitude/gco:Decimal, '.')"/>
			<sch:let name="south-dec"
				value="substring-after(gmd:southBoundLatitude/gco:Decimal, '.')"/>

			<!-- assertions and report -->
			<sch:assert test="(-180.00 &lt;= $west) and ($west &lt;= 180.00)">L'elemento
				"Longitudine Ovest" non e' presente o ha un valore sbagliato</sch:assert>
			<sch:report role="INFO" test="(-180.00 &lt;= $west) and ($west &lt;= 180.00)"
				>Longitudine Ovest: <sch:value-of select="$west"/>
			</sch:report>
			<sch:assert test="(-180.00 &lt;= $east) and ($east &lt;= 180.00)">L'elemento
				"Longitudine Est" non e' presente o ha un valore sbagliato</sch:assert>
			<sch:report role="INFO" test="(-180.00 &lt;= $east) and ($east &lt;= 180.00)"
				>Longitudine Est: <sch:value-of select="$east"/>
			</sch:report>
			<sch:assert test="(-90.00 &lt;= $south) and ($south &lt;= $north)">L'elemento
				"Latitudine Sud" non e' presente o ha un valore sbagliato</sch:assert>
			<sch:report role="INFO" test="(-90.00 &lt;= $south) and ($south &lt;= $north)"
				>Latitudine Sud: <sch:value-of select="$south"/>
			</sch:report>
			<sch:assert test="($south &lt;= $north) and ($north &lt;= 90.00)">L'elemento "Latitudine
				Nord" non e' presente o ha un valore sbagliato</sch:assert>
			<sch:report role="INFO" test="($south &lt;= $north) and ($north &lt;= 90.00)">Latitudine
				Nord: <sch:value-of select="$north"/>
			</sch:report>
			
			<!-- Verifica presenza di due cifre decimali -->
			<sch:assert test="string-length($west-dec) &gt; 1">L'elemento
				"Longitudine Ovest" non ha almeno due cifre decimali</sch:assert>
			<sch:report role="INFO" test="string-length($west-dec) &gt; 1"
				>Longitudine Ovest - Numero cifre decimali: <sch:value-of select="string-length($west-dec)"/>
			</sch:report>
			<sch:assert test="string-length($east-dec) &gt; 1">L'elemento
				"Longitudine Est" non ha almeno due cifre decimali</sch:assert>
			<sch:report role="INFO" test="string-length($east-dec) &gt; 1"
				>Longitudine Est - Numero cifre decimali: <sch:value-of select="string-length($east-dec)"/>
			</sch:report>
			<sch:assert test="string-length($south-dec) &gt; 1">L'elemento
				"Latitudine Sud" non ha almeno due cifre decimali</sch:assert>
			<sch:report role="INFO" test="string-length($south-dec) &gt; 1"
				>Latitudine Sud - Numero cifre decimali: <sch:value-of select="string-length($south-dec)"/>
			</sch:report>
			<sch:assert test="string-length($north-dec) &gt; 1">L'elemento "Latitudine
				Nord" non ha almeno due cifre decimali</sch:assert>
			<sch:report role="INFO" test="string-length($north-dec) &gt; 1">Latitudine
				Nord - Numero cifre decimali: <sch:value-of select="string-length($north-dec)"/>
			</sch:report>
		</sch:rule>
				
		<!-- Estensione verticale: se non entra nella rule va bene perché è opzionale, ma se entra ci devono essere i valori -->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:identificationInfo/*/*/gmd:EX_Extent/gmd:verticalElement">
			
			<sch:let name="quotaMinima"
				value="gmd:EX_VerticalExtent/gmd:minimumValue/*/text()"/>
			<sch:let name="quotaMassima"
				value="gmd:EX_VerticalExtent/gmd:maximumValue/*/text()"/>
			<!-- Non e' chiaro qual è la lista di riferimento, per ora testo solo l'esistenza -->
			<sch:let name="CRSVerticale"
				value="gmd:EX_VerticalExtent/gmd:verticalCRS/@xlink:href"/>
			
			<!-- assertions and report -->
			<sch:assert test="$quotaMinima">Estensione Verticale: la quota minima e' assente</sch:assert>
			<sch:report role="INFO" test="$quotaMinima">Estensione Verticale: quota minima:
				<sch:value-of select="$quotaMinima"/>
			</sch:report>
			<sch:assert test="$quotaMassima">Estensione Verticale: la quota massima e' assente</sch:assert>
			<sch:report role="INFO" test="$quotaMassima">Estensione Verticale: quota massima:
				<sch:value-of select="$quotaMassima"/>
			</sch:report>	
			<sch:assert test="$CRSVerticale">Estensione Verticale: il CRS e' assente</sch:assert>
			<sch:report role="INFO" test="$CRSVerticale">Estensione Verticale: CRS:
				<sch:value-of select="$CRSVerticale"/>
			</sch:report>	
		</sch:rule>


		<!-- Estensione temporale: se non entra nella rule va bene perché è opzionale, ma se entra ci devono essere i valori -->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:identificationInfo/*/*/gmd:EX_Extent/gmd:temporalElement">

			<sch:let name="timePeriodId"
				value="gmd:EX_TemporalExtent/gmd:extent/gml:TimePeriod/@gml:id"/>
			<sch:let name="temporalExtentBegin"
				value="gmd:EX_TemporalExtent/gmd:extent/gml:TimePeriod/gml:beginPosition/text()"/>
				<sch:let name="temporalExtentBeginPar"
				value="gmd:EX_TemporalExtent/gmd:extent/gml:TimePeriod/gml:beginPosition/@indeterminatePosition"/>
			<sch:let name="temporalExtentEnd"
				value="gmd:EX_TemporalExtent/gmd:extent/gml:TimePeriod/gml:endPosition/text()"/>
			<sch:let name="temporalExtentEndPar"
				value="gmd:EX_TemporalExtent/gmd:extent/gml:TimePeriod/gml:endPosition/@indeterminatePosition"/>

			<!-- assertions and report -->
			<sch:assert test="$timePeriodId">L'identificativo del periodo temporale è mancante </sch:assert>
			<sch:report role="INFO" test="$timePeriodId">identificativo del periodo temporale:
					<sch:value-of select="$timePeriodId"/>
			</sch:report>

			<sch:assert test="$temporalExtentBegin or ($temporalExtentBeginPar='now' or $temporalExtentBeginPar='unknown')">Estensione temporale Data inizio: 
				manca la data o il parametro indeterminatePosition</sch:assert>
			<sch:report role="INFO" test="$temporalExtentBegin">Estensione temporale - Data inizio:
					<sch:value-of select="$temporalExtentBegin"/>
			</sch:report>
			<sch:assert test="$temporalExtentEnd or ($temporalExtentEndPar='now' or $temporalExtentEndPar='unknown')">Estensione temporale Data fine: 
				manca la data o il parametro indeterminatePosition</sch:assert>
			<sch:report role="INFO" test="$temporalExtentEnd">Estensione temporale - Data fine:
					<sch:value-of select="$temporalExtentEnd"/>
			</sch:report>
		</sch:rule>
	</sch:pattern>

	<!-- ############################################ -->
	<!-- Quality and validity: level, positionalaccuracy, topologica coherence, lineage, conformity -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Quality and validity for Conformity' elements</sch:title>
		<!-- In questa prima parte si testano tutti gli xPath delle altre regole, per essere sicuri che ci entri -->
		<sch:rule context="/gmd:MD_Metadata">
		
		
			<sch:let name="language" value="translate(gmd:language/gmd:LanguageCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="titoloIt" value="gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult/gmd:specification/gmd:CI_Citation/gmd:title[starts-with (translate(./*/text(), $uppercase, $lowercase), 'regolamento (ue) n. 1089/2010')]/*"/>
			<sch:let name="titoloEn" value="gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult/gmd:specification/gmd:CI_Citation/gmd:title[starts-with (translate(./*/text(), $uppercase, $lowercase), 'commission regulation (eu) no 1089/2010')]/*"/>
		
			<sch:assert test="gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:scope/gmd:DQ_Scope">La struttura dell'xml è errata: sezione /gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:scope/gmd:DQ_Scope non presente </sch:assert>
			<sch:assert test="gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_AbsoluteExternalPositionalAccuracy">La struttura dell'xml è errata: sezione /gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_AbsoluteExternalPositionalAccuracy non presente </sch:assert>
			<sch:assert test="gmd:dataQualityInfo/gmd:DQ_DataQuality//gmd:lineage">La struttura dell'xml è errata: sezione /gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:lineage non presente </sch:assert>
		
			<sch:assert test="($titoloEn and $language='eng') or ($titoloIt and $language='ita')">Il valore relativo alla conformità N. 1089/2010 è assente</sch:assert>
        </sch:rule>

		<!-- Sempre regola generica ma separata per fare il match con tutti i report -->
		<!--<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality">
                <sch:let name="titoloSpecs" value="gmd:report/gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult/gmd:specification/gmd:CI_Citation/gmd:title[starts-with (./*/text(), 'REGOLAMENTO (UE) N. 1089/2010')]/*"/>
                <sch:assert test="$titoloSpecs">Il valore relativo alla conformità N. 1089/2010 è assente</sch:assert>
        </sch:rule>-->
		 
		<!-- Livello (descrizione non richiesta per dataset e serie)-->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:scope/gmd:DQ_Scope">
			<sch:let name="scopeLevelCode" value="gmd:level/gmd:MD_ScopeCode/@codeListValue"/>
			<sch:let name="scopeLevelCodeOK" value="translate($scopeLevelCode, $uppercase, $lowercase) = 'dataset' or translate($scopeLevelCode, $uppercase, $lowercase) = 'serie' or translate($scopeLevelCode, $uppercase, $lowercase) = 'series'"/>

			<!-- assertions and report -->
			<sch:assert test="$scopeLevelCodeOK">L'elemento "Livello di qualita' non e' presente o
				ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$scopeLevelCodeOK">Livello di qualita': <sch:value-of
					select="$scopeLevelCode"/>
			</sch:report>
		</sch:rule>

		<!-- Accuratezza posizionale --> 
		<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_AbsoluteExternalPositionalAccuracy">
			<sch:let name="positionalAccuracy_value" value="gmd:result/gmd:DQ_QuantitativeResult/gmd:value/gco:Record/gco:Real/text()"/>
			<sch:let name="positionalAccuracy_valueUnit" value="gmd:result/gmd:DQ_QuantitativeResult/gmd:valueUnit/gml:BaseUnit/gml:identifier/text()"/>
			<sch:let name="positionalAccuracy_valueUnitSystem" value="gmd:result/gmd:DQ_QuantitativeResult/gmd:valueUnit/gml:BaseUnit/gml:unitsSystem/@xlink:href"/>
			
			<!-- assertions and report -->
			<sch:assert test="$positionalAccuracy_value">L'elemento "Accuratezza posizionale - Valore" non e' presente</sch:assert>
			<sch:report role="INFO" test="$positionalAccuracy_value">Accuratezza posizionale - Valore:
				<sch:value-of select="$positionalAccuracy_value"/>
			</sch:report>
			<sch:assert test="$positionalAccuracy_valueUnit = 'm'">L'elemento "Accuratezza posizionale - Unita' di misura" non e' presente o è diverso da 'm'</sch:assert> 
			<sch:report role="INFO" test="$positionalAccuracy_valueUnit">Accuratezza posizionale - Unita' di misura:
				<sch:value-of select="$positionalAccuracy_valueUnit"/>
			</sch:report>
			<sch:assert test="$positionalAccuracy_valueUnitSystem">L'elemento "Accuratezza posizionale - Sistema di unita' di misura" non e' presente</sch:assert> 
			<sch:report role="INFO" test="$positionalAccuracy_valueUnitSystem">Accuratezza posizionale - Sistema di Unita' di misura:
				<sch:value-of select="$positionalAccuracy_valueUnitSystem"/>
			</sch:report>

		</sch:rule>

		<!-- Coerenza topologica qualitativa (0,n) --> 
		<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_TopologicalConsistency/gmd:result/gmd:DQ_ConformanceResult">
			<sch:let name="metodo" value="../../gmd:evaluationMethodType/gmd:DQ_EvaluationMethodTypeCode/@codeListValue"/>
			<sch:let name="titolo" value="gmd:specification/gmd:CI_Citation/gmd:title/gco:CharacterString/text()"/>	
			<sch:let name="data" value="gmd:specification/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:date/gco:Date/text()"/>
			<sch:let name="tipodata" value="gmd:specification/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			<sch:let name="pass" value="gmd:pass/gco:Boolean/text()"/>
			<sch:let name="passNIL" value="gmd:pass/@gco:nilReason"/>
			
			<!-- assertions and report -->
			<sch:assert test="$metodo = 'directInternal' or $metodo = 'directExternal' or $metodo = 'indirect' or not($metodo)">L'elemento "Coerenza topologica - Metodo" ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$metodo">Coerenza topologica - Metodo:
				<sch:value-of select="$metodo"/>
			</sch:report>	
			
			<sch:assert test="$titolo">L'elemento "Coerenza topologica - Titolo" non e' presente</sch:assert>
			<sch:report role="INFO" test="$titolo">Coerenza topologica - Titolo:
				<sch:value-of select="$titolo"/>
			</sch:report>			
			<sch:assert test="$data">L'elemento "Coerenza topologica - Data" non e' presente</sch:assert>
			<sch:report role="INFO" test="$data">Coerenza topologica - Data:
				<sch:value-of select="$data"/>
			</sch:report>				
			<sch:assert test="$tipodata">L'elemento "Coerenza topologica - Tipo Data" non e' presente</sch:assert>
			<sch:report role="INFO" test="$tipodata">Coerenza topologica - Tipo Data:
				<sch:value-of select="$tipodata"/>
			</sch:report>			
			
			<sch:assert test="$pass = 'true' or $pass = 'false' or $passNIL = 'unknown' or not($pass)">Il valore campo 'pass' della Coerenza Topologica Descrittiva è assente o errato</sch:assert>
	
		</sch:rule>

		<!-- Coerenza topologica quantitativa (0,n) --> 
		<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report/gmd:DQ_TopologicalConsistency/gmd:result/gmd:DQ_QuantitativeResult">
			<sch:let name="metodo" value="../../gmd:evaluationMethodType/gmd:DQ_EvaluationMethodTypeCode/@codeListValue"/>
			<sch:let name="topologicalConsistency_Record" value="gmd:value/gco:Record"/>
			<sch:let name="topologicalConsistency_valuetype" value="gmd:value/gco:Record/@xsi:type"/>
			
			<!-- assertions and report -->
			<sch:assert test="$metodo = 'directInternal' or $metodo = 'directExternal' or $metodo = 'indirect' or not($metodo)">L'elemento "Coerenza topologica - Metodo" ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$metodo">Coerenza topologica - Metodo:
				<sch:value-of select="$metodo"/>
			</sch:report>

			<sch:assert test="$topologicalConsistency_Record">L'elemento "Coerenza topologica - Record" non e' presente</sch:assert>
			<sch:report role="INFO" test="$topologicalConsistency_Record">Coerenza topologica - Record:
				<sch:value-of select="$topologicalConsistency_Record"/>
			</sch:report>
			
			<sch:assert test="$topologicalConsistency_valuetype">L'elemento "Coerenza topologica - xsi:type" non e' presente</sch:assert>
			<sch:report role="INFO" test="$topologicalConsistency_valuetype">Coerenza topologica - xsi:type:
				<sch:value-of select="$topologicalConsistency_valuetype"/>
			</sch:report>
	
		</sch:rule>

		<!-- Genealogia --> 
		<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:lineage">
			<sch:let name="lineage" value="gmd:LI_Lineage/gmd:statement/gco:CharacterString/text()"/>
			<!-- assertions and report -->
			<sch:assert test="$lineage">L'elemento "Genealogia" non e' presente</sch:assert>
			<sch:report role="INFO" test="$lineage">Genealogia:
				<sch:value-of select="$lineage"/>
			</sch:report>
		</sch:rule>

		<!-- Specifiche di conformità. Possono essere n a me interessa la molteplicità di gmd:DQ_ConformanceResult, ma ognuna è diversa. 
		Ci deve essere obbligatoriamente la citazione del regolamento 1089/2010. 
		Dato che si possono usare Anchor oppure Character, per fare queste verifiche mi metto ad un livello superiore  -->
		<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality/gmd:report[starts-with(translate(gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult/gmd:specification/gmd:CI_Citation/gmd:title/*/text(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), 'regolamento (ue) n. 1089/2010')]/gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult">

			<sch:let name="titolo" value="translate(gmd:specification/gmd:CI_Citation/gmd:title/*/text(), $uppercase, $lowercase)"/>
			<sch:let name="titoloLink" value="gmd:specification/gmd:CI_Citation/gmd:title/gmx:Anchor/@xlink:href"/>
			<sch:let name="data" value="gmd:specification/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:date/gco:Date/text()"/>
			<sch:let name="tipodata" value="gmd:specification/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			<sch:let name="pass" value="gmd:pass/gco:Boolean/text()"/>
			<sch:let name="passNIL" value="gmd:pass/@gco:nilReason"/>
			
			<sch:let name="titoloInizio" value="'regolamento (ue) n. 1089/2010 della commissione del 23 novembre 2010 recante attuazione della direttiva 2007/2/ce del parlamento europeo e del consiglio per quanto riguarda l'"/>
			<sch:let name="titoloFine" value="'interoperabilità dei set di dati territoriali e dei servizi di dati territoriali'"/>
			
			<sch:assert test="(		starts-with($titolo, $titoloInizio) 
									and 
									(substring($titolo, string-length($titoloInizio) + 2) = $titoloFine)
									and 
									string-length($titolo) = 255
									and
									(not($titoloLink) or $titoloLink = 'http://data.europa.eu/eli/reg/2010/1089')
									
							)">Il testo o il link del valore della conformità relativo al regolamento N. 1089/2010 è assente o errato</sch:assert>
			
			
			<sch:assert test="$data = '2010-12-08'">Il valore della data conformità relativo al regolamento N. 1089/2010 deve essere 2010-12-08</sch:assert>
			<sch:assert test="$tipodata = 'publication'">Il valore del tipo della data conformità relativo al regolamento N. 1089/2010 deve essere 'publication'</sch:assert>
			<sch:assert test="$pass = 'true' or $pass = 'false' or $passNIL = 'unknown' or not($pass)">Il valore campo 'pass' della conformità relativo al regolamento N. 1089/2010 è errato</sch:assert>

			<sch:report role="INFO" test="$titolo">Valore conformità (REGOLAMENTO (UE) N. 1089/2010): <sch:value-of select="$titolo"/> </sch:report>
			<sch:report role="INFO" test="$data">Valore della data conformità relativo al regolamento N. 1089/2010: <sch:value-of select="$data"/></sch:report>
			<sch:report role="INFO" test="$tipodata">Valore del tipo della data conformità relativo al regolamento N. 1089/2010: <sch:value-of select="$tipodata"/> </sch:report>
			<sch:report role="INFO" test="$pass">Valore campo 'pass' della conformità relativo al regolamento N. 1089/2010: <sch:value-of select="$pass"/></sch:report>

		</sch:rule>
		
		<!-- Verifica titolo Regolamento UE in inglese -->
		
		<sch:rule context="/gmd:MD_Metadata/gmd:dataQualityInfo/gmd:DQ_DataQuality[starts-with(translate(gmd:report/gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult/gmd:specification/gmd:CI_Citation/gmd:title/*/text(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), 'commission regulation (eu) no 1089/2010')]/gmd:report/gmd:DQ_DomainConsistency/gmd:result/gmd:DQ_ConformanceResult">

			<sch:let name="titolo" value="translate(gmd:specification/gmd:CI_Citation/gmd:title/*/text(), $uppercase, $lowercase)"/>
			<sch:let name="titoloLink" value="gmd:specification/gmd:CI_Citation/gmd:title/gmx:Anchor/@xlink:href"/>
			<sch:let name="data" value="gmd:specification/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:date/gco:Date/text()"/>
			<sch:let name="tipodata" value="gmd:specification/gmd:CI_Citation/gmd:date/gmd:CI_Date/gmd:dateType/gmd:CI_DateTypeCode/@codeListValue"/>
			<sch:let name="pass" value="gmd:pass/gco:Boolean/text()"/>
			<sch:let name="passNIL" value="gmd:pass/@gco:nilReason"/>
			
			<sch:let name="titoloEn" value="'commission regulation (eu) no 1089/2010 of 23 november 2010 implementing directive 2007/2/ec of the european parliament and of the council as regards interoperability of spatial data sets and services'"/>
			
			<sch:assert test="$titolo=$titoloEn
									and
									(not($titoloLink) or $titoloLink = 'http://data.europa.eu/eli/reg/2010/1089'
									
							)">Il testo o il link del valore della conformità relativo al regolamento N. 1089/2010 è assente o errato</sch:assert>
			
			
			<sch:assert test="$data = '2010-12-08'">Il valore della data conformità relativo al regolamento N. 1089/2010 deve essere 2010-12-08</sch:assert>
			<sch:assert test="$tipodata = 'publication'">Il valore del tipo della data conformità relativo al regolamento N. 1089/2010 deve essere 'publication'</sch:assert>
			<sch:assert test="$pass = 'true' or $pass = 'false' or $passNIL = 'unknown' or not($pass)">Il valore campo 'pass' della conformità relativo al regolamento N. 1089/2010 è errato</sch:assert>

			<sch:report role="INFO" test="$titolo">Valore conformità (REGOLAMENTO (UE) N. 1089/2010): <sch:value-of select="$titolo"/> </sch:report>
			<sch:report role="INFO" test="$data">Valore della data conformità relativo al regolamento N. 1089/2010: <sch:value-of select="$data"/></sch:report>
			<sch:report role="INFO" test="$tipodata">Valore del tipo della data conformità relativo al regolamento N. 1089/2010: <sch:value-of select="$tipodata"/> </sch:report>
			<sch:report role="INFO" test="$pass">Valore campo 'pass' della conformità relativo al regolamento N. 1089/2010: <sch:value-of select="$pass"/></sch:report>

		</sch:rule>

	</sch:pattern>


	<!-- ############################################ -->
	<!-- Reference System                         -->
	<!-- Obbligatorio. Mantengo simile ai servizi										-->
	<!-- ############################################ -->
	<!--<sch:pattern>
		<sch:title>Testing 'Reference System' elements</sch:title>
		<sch:rule context="/gmd:MD_Metadata">
			<sch:let name="RS_Richiesto" value="'1'" />
			<sch:let name="RS_Presente" value="gmd:referenceSystemInfo/gmd:MD_ReferenceSystem/gmd:referenceSystemIdentifier/gmd:RS_Identifier" />

			<sch:assert test="($RS_Richiesto='1' and $RS_Presente) or ($RS_Richiesto!='1')">La struttura dell'xml è errata: sezione
				/gmd:MD_Metadata/gmd:referenceSystemInfo/gmd:MD_ReferenceSystem/gmd:referenceSystemIdentifier/gmd:RS_Identifier
				non presente </sch:assert>
				</sch:rule>-->
		
		<!-- La lista dei sistemi di riferimento e' fissa. Devo verificare il testo che può essere il nome o l'EPSG, il link che è solo EPSG -->
		<!--<sch:rule
			context="/gmd:MD_Metadata/gmd:referenceSystemInfo/gmd:MD_ReferenceSystem/gmd:referenceSystemIdentifier/gmd:RS_Identifier">
			<sch:let name="RS_Code" value="translate(gmd:code/*/text(), $uppercase, $lowercase)"/>
			<sch:let name="RS_CodeOK"
				value="
				$RS_Code = 'etrs89-xyz' or
				$RS_Code = 'etrs89-grs80h' or
				$RS_Code = 'etrs89-grs80' or
				$RS_Code = 'etrs89-laea' or
				$RS_Code = 'etrs89-lcc' or
				$RS_Code = 'etrs89-utm32n' or
				$RS_Code = 'etrs89-utm33n' or
				$RS_Code = 'etrs89-utm34n' or
				$RS_Code = 'rdn2008-6704' or
				$RS_Code = 'rdn2008-6705' or
				$RS_Code = 'rdn2008-6706' or
				$RS_Code = 'rdn2008-tm32ne' or
				$RS_Code = 'rdn2008-tm32en' or
				$RS_Code = 'rdn2008-tm33ne' or
				$RS_Code = 'rdn2008-tm33en' or
				$RS_Code = 'rdn2008-tm34ne' or
				$RS_Code = 'rdn2008-tm34en' or
				$RS_Code = 'rdn2008-italyne' or
				$RS_Code = 'rdn2008-italyen' or
				$RS_Code = 'rdn2008-12ne' or
				$RS_Code = 'rdn2008-12en' or
				$RS_Code = 'ed50' or
				$RS_Code = 'ed50-utm32n' or
				$RS_Code = 'ed50-utm33n' or
				$RS_Code = 'ed50-utm34n' or
				$RS_Code = 'monte-mario-rome' or
				$RS_Code = 'monte-mario' or
				$RS_Code = 'monte-mario-italy1' or
				$RS_Code = 'monte-mario-italy2' or
				$RS_Code = 'evrs' or
				$RS_Code = 'lat' or
				$RS_Code = 'msl' or
				$RS_Code = 'isa' or
				$RS_Code = 'wgs84' or
				$RS_Code = 'etrs89/etrs-tm32' or
				$RS_Code = 'etrs89/etrs-tm33' or
				$RS_Code = 'wgs84/utm 32n' or
				$RS_Code = 'wgs84/utm 33n' or
				$RS_Code = 'wgs84/utm 34n' or
				$RS_Code = 'monte mario / tm emilia-romagna' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4936' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4937' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4258' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/3035' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/3034' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/25832' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/25833' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/25834' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6704' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6705' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6706' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6707' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/9.6.1/7791' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6708' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/9.6.1/7792' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6709' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/9.6.1/7793' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6875' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/9.6.1/7794' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/6876' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/9.6.1/7795' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4230' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/23032' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/23033' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/23034' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4806' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4265' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/3003' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/3004' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/5730' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/5861' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/5715' or
				$RS_Code = 'http://codes.wmo.int/grib2/codeflag/4.2/_0-3-3' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/7409' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/4326' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/3044' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/3045' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/32632' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/32633' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/32634' or
				$RS_Code = 'http://www.opengis.net/def/crs/epsg/0/5659'"/>-->
			
			<!-- Se c'è il codespace allora il codice può essere solo il numero -->
			<!--<sch:let name="RS_codeSpace"
				value="gmd:codeSpace/gco:CharacterString/text() = 'http://www.epsg-registry.org/' or gmd:codeSpace/gco:CharacterString/text() = 'http://www.epsg-registry.org'"/>
			<sch:let name="RS_codeSpaceOK"
				value="$RS_Code = '4936' or
				$RS_Code = '4937' or
				$RS_Code = '4258' or
				$RS_Code = '3035' or
				$RS_Code = '3034' or
				$RS_Code = '25832' or
				$RS_Code = '25833' or
				$RS_Code = '25834' or
				$RS_Code = '6704' or
				$RS_Code = '6705' or
				$RS_Code = '6706' or
				$RS_Code = '6707' or
				$RS_Code = '7791' or
				$RS_Code = '6708' or
				$RS_Code = '7792' or
				$RS_Code = '6709' or
				$RS_Code = '7793' or
				$RS_Code = '6875' or
				$RS_Code = '7794' or
				$RS_Code = '6876' or
				$RS_Code = '7795' or
				$RS_Code = '4230' or
				$RS_Code = '23032' or
				$RS_Code = '23033' or
				$RS_Code = '23034' or
				$RS_Code = '4806' or
				$RS_Code = '4265' or
				$RS_Code = '3003' or
				$RS_Code = '3004' or
				$RS_Code = '5730' or
				$RS_Code = '5861' or
				$RS_Code = '5715' or
				$RS_Code = '7409' or
				$RS_Code = '4326' or
				$RS_Code = '3044' or
				$RS_Code = '3045' or
				$RS_Code = '32632' or
				$RS_Code = '32633' or
				$RS_Code = '32634' or
				$RS_Code = '7409' or
				$RS_Code = '5659'"/>-->
			
			<!-- Infine ci potrebbe essere il link -->
			<!--<sch:let name="RS_Link" value="translate(gmd:code/gmx:Anchor/@xlink:href, $uppercase, $lowercase)"/>
			<sch:let name="RS_LinkOK" value="$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4936' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4937' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4258' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/3035' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/3034' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/25832' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/25833' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/25834' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6704' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6705' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6706' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6707' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/9.6.1/7791' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6708' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/9.6.1/7792' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6709' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/9.6.1/7793' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6875' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/9.6.1/7794' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/6876' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/9.6.1/7795' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4230' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/23032' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/23033' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/23034' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4806' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4265' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/3003' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/3004' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/5730' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/5861' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/5715' or
				$RS_Link = 'http://codes.wmo.int/grib2/codeflag/4.2/_0-3-3' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/7409' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/4326' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/3044' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/3045' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/32632' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/32633' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/32634' or
				$RS_Link = 'http://www.opengis.net/def/crs/epsg/0/5659'"/>-->
			
			
			<!-- assertions and report. Per ogni elemento se c'è allora lo devo testare. Se c'è il link iol resto no mi importa -->
			<!--<sch:assert test="($RS_Code and $RS_CodeOK) or ($RS_codeSpace and $RS_codeSpaceOK) or ($RS_Link and $RS_LinkOK)">L'elemento "Sistema di
				riferimento" e' errato o assente</sch:assert>
			<sch:report role="INFO" test="$RS_Code">Sistema di riferimento:
				<sch:value-of select="$RS_Code"/>
			</sch:report>
			
		</sch:rule>			
		
	</sch:pattern>-->	
		
	<!-- ############################################ -->
	<!-- Distribution                         -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Distribution' elements</sch:title>
		<sch:rule context="/gmd_MD_Metadata">
			<sch:assert test="gmd:distributionInfo/gmd:MD_Distribution/gmd:distributionFormat">La struttura dell'xml è errata: sezione //gmd:distributionInfo/gmd:MD_Distribution/gmd:distributionFormat non presente </sch:assert>
			<sch:assert test="gmd:distributionInfo/gmd:MD_Distribution/gmd:distributor">La struttura dell'xml è errata: sezione //gmd:distributionInfo/gmd:MD_Distribution/gmd:distributor non presente </sch:assert>
		</sch:rule>
		
		<!-- Formato. Per il nome  viene verificato solo l'esistenza -->
		<sch:rule context="/gmd:MD_Metadata/gmd:distributionInfo/gmd:MD_Distribution/gmd:distributionFormat">
			<sch:let name="distributionFormat_nameOK" value="gmd:MD_Format/gmd:name/*/text()"/>
			<sch:let name="distributionFormat_AnchorLink" value="gmd:MD_Format/gmd:name/gmx:Anchor/@xlink:href"/>
			
			<sch:let name="distributionFormat_AnchorOK" value="$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-shapefile' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/application/geo+json' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-filegdb' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/application/gml+xml' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-gmz' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/application/vnd.google-earth.kml+xml' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/application/vnd.google-earth.kmz' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-ecw' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-ascii-grid' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-oracledump' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-las' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-laz' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-tab' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-tab-raster' or
				$distributionFormat_AnchorLink='https://inspire.ec.europa.eu/media-types/application/x-worldfile' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/application/vnd.sqlite3' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/application/geopackage+sqlite3' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/image/jp2' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/image/tiff' or
				$distributionFormat_AnchorLink='https://www.iana.org/assignments/media-types/text/csv' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-shapefile' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/application/geo+json' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-filegdb' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/application/gml+xml' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-gmz' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/application/vnd.google-earth.kml+xml' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/application/vnd.google-earth.kmz' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-ecw' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-ascii-grid' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-oracledump' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-las' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-laz' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-tab' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-tab-raster' or
				$distributionFormat_AnchorLink='http://inspire.ec.europa.eu/media-types/application/x-worldfile' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/application/vnd.sqlite3' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/application/geopackage+sqlite3' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/image/jp2' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/image/tiff' or
				$distributionFormat_AnchorLink='http://www.iana.org/assignments/media-types/text/csv'"/>	
			
			<sch:let name="distributionFormat_version" value="gmd:MD_Format/gmd:version/gco:CharacterString/text()"/>
			<!-- assertions and report -->
			<!--<sch:assert test="$distributionFormat_nameOK">L'elemento "Formato di distribuzione - Nome formato" non e' presente</sch:assert>
			<sch:report role="INFO" test="$distributionFormat_nameOK">Formato di distribuzione - Nome formato: <sch:value-of select="$distributionFormat_nameOK"/>
			</sch:report>
			
			<sch:assert test="$distributionFormat_AnchorOK">L'elemento "Formato di distribuzione - Link formato anchor" non e' presente o ha un formato errato</sch:assert>
			<sch:report role="INFO" test="1=1">Formato di distribuzione - Link formato Anchor: <sch:value-of select="$distributionFormat_AnchorLink"/>
			</sch:report>-->
			<sch:assert test="$distributionFormat_AnchorOK or $distributionFormat_nameOK">L'elemento "Formato di distribuzione - Nome formato" non e' presente o ha un formato errato</sch:assert>
			<sch:report role="INFO" test="$distributionFormat_AnchorOK or $distributionFormat_nameOK">Formato di distribuzione - Nome formato: <sch:value-of select="$distributionFormat_nameOK"/>
			</sch:report>
			
			<sch:assert test="$distributionFormat_version">L'elemento "Formato di distribuzione - Versione formato" non e' presente</sch:assert>
			<sch:report role="INFO" test="$distributionFormat_version">Formato di distribuzione - Versione formato: <sch:value-of select="$distributionFormat_version"/>
			</sch:report>
		</sch:rule>

		<!-- Distributore -->
		<sch:rule
			context="/gmd:MD_Metadata/gmd:distributionInfo/gmd:MD_Distribution/gmd:distributor">
			<sch:let name="organisationName"
				value="gmd:MD_Distributor/gmd:distributorContact/gmd:CI_ResponsibleParty/gmd:organisationName/gco:CharacterString/text()"/>
			<sch:let name="role"
				value="translate(gmd:MD_Distributor/gmd:distributorContact/gmd:CI_ResponsibleParty/gmd:role/gmd:CI_RoleCode/text(), $uppercase, $lowercase)"/>
			<sch:let name="role_codeList"
				value="gmd:MD_Distributor/gmd:distributorContact/gmd:CI_ResponsibleParty/gmd:role/gmd:CI_RoleCode/@codeListValue"/>
			<sch:let name="emailAddress"
				value="gmd:MD_Distributor/gmd:distributorContact/gmd:CI_ResponsibleParty/gmd:contactInfo/gmd:CI_Contact/gmd:address/gmd:CI_Address/gmd:electronicMailAddress/gco:CharacterString/text()"/>
			
			<!-- assert and reports -->
			<sch:assert test="$organisationName">L'elemento "Distributore - Nome Ente" non e'
				presente</sch:assert>
			<sch:report role="INFO" test="$organisationName">Distributore - Nome Ente: <sch:value-of
				select="$organisationName"/>
			</sch:report>
			
			<!-- Il ruolo può essere qualunque  -->
			<!-- testo -->
			<sch:assert
				test="
				$role = 'punto di contatto' or $role = 'pointofcontact' or
				$role = 'distributore' or $role = 'distributor' or
				$role = 'fornitore della risorsa' or $role = 'resourceprovider' or
				$role = 'custode' or $role = 'custodian' or
				$role = 'proprietario' or $role = 'owner' or
				$role = 'utente' or $role = 'user' or
				$role = 'editore' or $role = 'publisher' or
				$role = 'autore' or $role = 'author' or
				$role = 'responsabile del trattamento' or $role = 'processor' or
				$role = 'responsabile principale delle ricerche' or $role = 'principalInvestigator' or
				$role = 'ideatore' or $role = 'originator'"
				>Distributore: Il valore del ruolo del responsabile della risorsa è assente o errato</sch:assert>
			<sch:report role="INFO" test="$role">Distributore: valore Ruolo: <sch:value-of select="$role"/>
			</sch:report>
			<!-- codelist -->
			<sch:assert
				test="
				$role_codeList = 'pointOfContact' or
				$role_codeList = 'distributor' or
				$role_codeList = 'resourceProvider' or
				$role_codeList = 'custodian' or
				$role_codeList = 'owner' or
				$role_codeList = 'user' or
				$role_codeList = 'originator' or
				$role_codeList = 'principalInvestigator' or
				$role_codeList = 'processor' or
				$role_codeList = 'publisher' or
				$role_codeList = 'author'"
				>Distributore: il Codice del ruolo del distributore è assente o errato</sch:assert>
			<sch:report role="INFO" test="$role_codeList">Distributore: Valore Codice Ruolo: <sch:value-of
				select="$role_codeList"/>
			</sch:report>
			
			<sch:assert test="$emailAddress">L'elemento "Distributore - E-mail" non e' presente </sch:assert>
			<sch:report role="INFO" test="$emailAddress">Distributore - E-mail: <sch:value-of
				select="$emailAddress"/>
			</sch:report>
			
		</sch:rule>


		<!-- Risorsa online (0,*) -->
		<sch:rule context="/gmd:MD_Metadata/gmd:distributionInfo/gmd:MD_Distribution/gmd:transferOptions">
			<sch:let name="URL" value="gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:linkage/gmd:URL/text()"/>
			<sch:let name="Protocollo" value="gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:protocol/gmx:Anchor/@xlink:href"/>
			<sch:let name="ProfiloApplicativo" value="gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:applicationProfile/gmx:Anchor/@xlink:href"/>

			<!-- Gli ultimi 2 da confermare -->
			<!-- Verifico non solo il prorotollo ma anche la coerenza con il profilo applicativo -->
			<sch:let name="ProtocolloProfiloOK" 
			value="($Protocollo = 'http://www.opengis.net/def/serviceType/ogc/csw' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/discovery') or
				($Protocollo = 'http://www.opengis.net/def/serviceType/ogc/sos' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/download') or
				($Protocollo = 'http://www.opengis.net/def/serviceType/ogc/wcs' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/download') or
				($Protocollo = 'http://www.opengis.net/def/serviceType/ogc/wfs' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/download') or
				($Protocollo = 'http://www.opengis.net/def/serviceType/ogc/wms' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/view') or
				($Protocollo = 'http://www.opengis.net/def/serviceType/ogc/wmts' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/view') or
				($Protocollo = 'https://tools.ietf.org/html/rfc4287' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/download') or
				(($Protocollo = 'http://www.w3.org/TR/xlink/' or $Protocollo = 'http://www.w3.org/TR/xlink') and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/other') or
				($Protocollo = 'https://registry.geodati.gov.it/metadata-codelist/ProtocolValue/www-download' and $ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/other')"/>	
			<!--<sch:let name="ProfiloApplicativoOK" value="$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/other' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/view' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/transformation' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/discovery' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/invoke' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/download'"/>
			<sch:let name="ProfiloApplicativoOK" value="$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/other' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/view' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/transformation' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/discovery' or
				$ProfiloApplicativo = 'http://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceType/download'"/>
				-->
				
			<sch:let name="Descrizione" value="gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:description/gmx:Anchor/@xlink:href"/>
			<sch:let name="DescrizioneOK" value="$Descrizione = 'http://inspire.ec.europa.eu/metadata-codelist/OnLineDescriptionCode/accessPoint' or $Descrizione = 'http://inspire.ec.europa.eu/metadata-codelist/OnLineDescriptionCode/endPoint'"/>
			
			<sch:assert test="$URL">Distribuzione: l'URL della risorsa online è assente o errato</sch:assert>
			<sch:report role="INFO" test="$URL">Distribuzione - URL della risorsa: <sch:value-of
				select="$URL"/>
			</sch:report>
			<sch:assert test="$ProtocolloProfiloOK">Distribuzione: il protocollo della risorsa online è assente o errato o non corrispondente al profilo applicativo</sch:assert>
			<sch:report role="INFO" test="$Protocollo">Distribuzione - protocollo: <sch:value-of
				select="$Protocollo"/>
			</sch:report>
			<sch:report role="INFO" test="$ProfiloApplicativo">Distribuzione - ProfiloApplicativo: <sch:value-of
				select="$ProfiloApplicativo"/>
			</sch:report>
			<!--			
			<sch:assert test="$ProfiloApplicativoOK">Distribuzione: il profilo applicativo della risorsa online è assente o errato</sch:assert>
			<sch:report role="INFO" test="$ProfiloApplicativoOK">Distributore - profilo applicativo: <sch:value-of
				select="$ProfiloApplicativo"/>
			</sch:report>
			-->
			
			<!--<sch:assert test="$DescrizioneOK">Distribuzione: la descrizione della risorsa online è assente o errata: deve essere @xlink:href = 'http://inspire.ec.europa.eu/metadata-codelist/OnLineDescriptionCode/accessPoint'</sch:assert>-->
			<sch:assert test="$DescrizioneOK">Distribuzione: la descrizione della risorsa online è assente o errata</sch:assert>
			<sch:report role="INFO" test="$DescrizioneOK">Distribuzione - descrizione della risorsa: <sch:value-of
				select="$Descrizione"/>
			</sch:report>	
		</sch:rule>	
	</sch:pattern>
	
	<!-- ############################################ -->
	<!-- Gestione dei dati: Frequenza di aggiornamento (0,*)                          -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Testing 'Maintenance' elements</sch:title>

		
		<!-- Frequenza di aggiornamento  -->
		<sch:rule context="/gmd:MD_Metadata/gmd:identificationInfo/gmd:MD_DataIdentification/gmd:resourceMaintenance">
			<sch:let name="frequenza" value="gmd:MD_MaintenanceInformation/gmd:maintenanceAndUpdateFrequency/gmd:MD_MaintenanceFrequencyCode/@codeListValue"/>
			<sch:assert test="$frequenza = 'continual' or 
				$frequenza = 'daily' or
				$frequenza = 'weekly' or 
				$frequenza = 'fortnightly' or
				$frequenza = 'monthly' or
				$frequenza = 'quarterly' or
				$frequenza = 'biannually' or
				$frequenza = 'annually' or
				$frequenza = 'asNeeded' or
				$frequenza = 'irregular' or
				$frequenza = 'notPlanned' or
				$frequenza = 'continual' or
				$frequenza = 'unknown'">Gestione dei dati: la frequenza di aggiornamento è assente o ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$frequenza">Gestione dei dati: frequenza di aggiornamento: <sch:value-of
				select="$frequenza"/>
			</sch:report>	
			
		</sch:rule>		
	</sch:pattern>
	
	<!-- ############################################ -->
	<!-- Dati raster                                  -->
	<!-- ############################################ -->
	<sch:pattern>
		<sch:title>Raster Georettificati - Georiferibili</sch:title>
		
		<!-- Informazioni sul contenuto --> 
		<sch:rule context="/gmd:MD_Metadata/gmd:contentInfo/gmd:MD_ImageDescription">
			<!-- descrizione attributi -->
			<sch:let name="recordType" value="gmd:attributeDescription/gco:RecordType/text()"/>
			<sch:assert test="$recordType">Raster: la descrizione degli attributi non è presente</sch:assert>
			<sch:report role="INFO" test="$recordType">Raster: descrizione degli attributi: <sch:value-of select="$recordType"/>
			</sch:report>
			
			<!-- Tipo di contenuto-->
			<sch:let name="contentType" value="gmd:contentType/gmd:MD_CoverageContentTypeCode/@codeListValue"/>
			<sch:assert test="$contentType = 'image' or $contentType = 'thematicClassification' or $contentType = 'physicalMeasurement'">Raster: Il tipo di contenuto non è presente o ha un valore non valido</sch:assert>
			<sch:report role="INFO" test="$contentType">Raster: tipo di contenuto: <sch:value-of select="$contentType"/>
			</sch:report>
			
		</sch:rule>
		
		<!-- Rappresentazione spaziale dati raster. Comune a georectified e georeferenceable  -->
		<sch:rule context="/gmd:MD_Metadata/gmd:spatialRepresentationInfo">
			<sch:let name="numDim" value="./*/gmd:numberOfDimensions/gco:Integer/text()"/>
			<sch:let name="conteggioDim" value="count(./*/gmd:axisDimensionProperties)"/>
			
			<!-- assertions and report -->
			<sch:assert test="$numDim">Raster: Il numero di dimensioni non è presente</sch:assert>
			<sch:report role="INFO" test="$numDim">Raster: numero di dimensioni: <sch:value-of select="$numDim"/>
			</sch:report>
			<sch:assert test="$numDim = $conteggioDim">Raster: Il numero di dimensioni descritte come XML non corrisponde a quanto indicato </sch:assert>
			<sch:report role="INFO" test="$conteggioDim">Raster: Conteggio di dimensioni: <sch:value-of select="$conteggioDim"/>
			</sch:report>
			
			<!-- Proprietà dimensioni -->
			<sch:let name="tipo" value="./*/gmd:axisDimensionProperties/gmd:MD_Dimension/gmd:dimensionName/gmd:MD_DimensionNameTypeCode/@codeListValue"/>
			<sch:let name="valoreDim" value="./*/gmd:axisDimensionProperties/gmd:MD_Dimension/*/gco:Integer/text()"/>
			<!-- assertions and report -->
			<sch:assert test="$tipo">Raster: Il tipo di dimensioni non è presente</sch:assert>
			<sch:report role="INFO"  test="$tipo">Raster: tipo di dimensioni: <sch:value-of select="$tipo"/>
			</sch:report>
			<sch:assert test="$valoreDim">Raster: Il valoreDim di dimensioni non è presente</sch:assert>
			<sch:report role="INFO" test="$valoreDim">Raster: valoreDim di dimensioni: <sch:value-of select="$valoreDim"/>
			</sch:report>
			
			<!-- Geometria della cella  -->
			<sch:let name="cellGeometry" value="./*/gmd:cellGeometry/gmd:MD_CellGeometryCode/@codeListValue"/>
			<sch:assert test="$cellGeometry = 'point' or $cellGeometry = 'area'">Raster: La geometria della cella non è presente o non ha un valore valido</sch:assert>
			<sch:report role="INFO" test="$cellGeometry">Raster: geometria della cella: <sch:value-of select="$cellGeometry"/>
			</sch:report>	
			
			<!-- Coefficienti trasformazione -->
			<sch:let name="transformation" value="./*/gmd:transformationParameterAvailability/gco:Boolean/text()"/>
			<sch:assert test="$transformation = 'true' or $transformation = 'false'">Raster: La disponibilita' dei coefficenti di trasformazione non è presente</sch:assert>
			<sch:report role="INFO" test="$transformation">Raster:  disponibilita' dei coefficenti di trasformazione: <sch:value-of select="$transformation"/>
			</sch:report>
		</sch:rule>
		
		
		<!-- Georectified  -->
		<sch:rule context="/gmd:MD_Metadata/gmd:spatialRepresentationInfo/gmd:MD_Georectified">
			<sch:let name="checkPoint" value="gmd:checkPointAvailability/gco:Boolean/text()"/>
			<sch:let name="pointInPixel" value="gmd:pointInPixel/gmd:MD_PixelOrientationCode/text()"/>
			<!-- assertions and report -->
			<sch:assert test="$checkPoint = 'true' or $checkPoint = 'false'">Raster Georectified: La disponibilita' dei check point non è presente ha un valore errato</sch:assert>
			<sch:report role="INFO" test="$checkPoint">Raster Georectified:  disponibilita' dei check point: <sch:value-of select="$checkPoint"/>
			</sch:report>
			<sch:assert test="$pointInPixel = 'center' or $pointInPixel = 'lowerLeft' or $pointInPixel = 'lowerRight' or $pointInPixel = 'upperLeft' or $pointInPixel = 'upperRight' ">Raster Georectified: posizione del Pixel non è presente o valore errato</sch:assert>
			<sch:report role="INFO" test="$pointInPixel">Raster Georectified: posizione del pixel: <sch:value-of select="$pointInPixel"/>
			</sch:report>
			
			<sch:let name="NumCornerPoints" value="count(gmd:cornerPoints/gml:Point/gml:coordinates/text())"/>
			<sch:assert test="$NumCornerPoints &gt; 1">Raster Georectified: I cornerPoints sono assenti o non validi</sch:assert>
			<sch:report role="INFO" test="$NumCornerPoints">Raster Georectified:cornerPoints: <sch:value-of select="$NumCornerPoints"/>
			</sch:report>
		</sch:rule>
		
		<!-- Georereferenced   -->
		<sch:rule context="/gmd:MD_Metadata/gmd:spatialRepresentationInfo/gmd:MD_Georeferenceable">
			<sch:let name="controlPoint" value="gmd:controlPointAvailability/gco:Boolean/text()"/>
			<sch:let name="orientationPoint" value="gmd:orientationParameterAvailability/gco:Boolean/text()"/>
			<sch:let name="georeferencedParameters" value="gmd:georeferencedParameters/gco:Record/text()"/>
			
			<!-- assertions and report -->
			<sch:assert test="$controlPoint">Raster Georeferenceable: La disponibilita' dei control point non è presente</sch:assert>
			<sch:report role="INFO" test="$controlPoint">Raster Georeferenceable:  disponibilita' dei control point: <sch:value-of select="$controlPoint"/>
			</sch:report>
			<sch:assert test="$orientationPoint= 'true' or $orientationPoint = 'false' ">Raster Georeferenceable: La disponibilita' dei parametri di orientamento non è presente o ha un valore non valido</sch:assert>
			<sch:report role="INFO" test="$orientationPoint">Raster Georeferenceable:  disponibilita' dei parametri di orientamento: <sch:value-of select="$orientationPoint"/>
			</sch:report>
			<sch:assert test="$georeferencedParameters">Raster Georeferenceable: La disponibilita' dei parametri per la georeferenziazione non è presente</sch:assert>
			<sch:report role="INFO" test="$georeferencedParameters">Raster Georeferenceable:  disponibilita' dei parametri per la georeferenziazione: <sch:value-of select="$georeferencedParameters"/>
			</sch:report>
		</sch:rule>	
	</sch:pattern>
	<!-- ############################################ -->

</sch:schema>
